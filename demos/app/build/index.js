var Hn=Object.defineProperty;var Tt=(t,n)=>{for(var r in n)Hn(t,r,{get:n[r],enumerable:!0,configurable:!0,set:(o)=>n[r]=()=>o})};var de={};Tt(de,{state:()=>{{return Zn}},handler:()=>{{return tr}},default:()=>{{return er}},context:()=>{{return Jn}},_static:()=>{{return Qn}}});var fe={};Tt(fe,{default:()=>{{return zn}}});var zn=`
  <section style="{ border: '2px solid gray', margin: '3rem', padding: '15px' }">
    <counter initial=state.initial
              on-update="value => console.log( value )">
      Count till 12
    </counter>

    <counter initial=1>
      Note: 10
    </counter>

    <p>I'm <span text="context.online ? 'Online' : 'Offline'"></span></p>

    <br><br>
    <button on-click="() => state.initial = 10">Reinitialize</button>
    <button title="Undo"
            style="background: black;color: white" 
            on-click="() => self.destroy()">Destroy</button>
    <br>
    <profile></profile>
  </section>
`;var le={};Tt(le,{default:()=>{{return Xn}}});var Xn=`
  <log( input.query )/>
  
  <section>
    User Account ID: <span @text=input.query.userid></span>
  </section>
`;var _e={};Tt(_e,{default:()=>{{return Wn}}});var Wn=`
  <section>
    <p>Product ID: <span @text=input.params.id></span></p>
    <p>Product Category: <span @text=input.query.category></span></p>
  </section>
`;var Qn={routes:[{path:"/",template:fe,default:!0},{path:"/account",template:le},{path:"/product/:id",template:_e}]},Zn={initial:3},Jn=["online"],tr={onRouteChange(...t){console.log("Route changed -- ",...t)},onPageNotFound(t){console.log(`<${t}> page not found`)}},er=`
<main>
  <router routes=static.routes
          global
          on-after(onRouteChange, 'after')
          on-before(onRouteChange, 'before')
          on-not-found(onPageNotFound)></router>
  
  <footer></footer>
</main>
`;var me={};Tt(me,{stylesheet:()=>{{return or}},state:()=>{{return ir}},handler:()=>{{return ar}},default:()=>{{return ur}},context:()=>{{return rr}},_static:()=>{{return nr}}});var nr={limit:12},rr=["lang"],ir={count:0},ar={onInput(){this.state.count=Number(this.input.initial)},handleClick(t){if(this.state.count>=this.static.limit)return;this.state.count++,this.emit("update",this.state.count)}},or=`
  span { font: 14px arial; color: blue; }
`,ur=`
  <div>
    <{input.renderer}/>: 
    <span @text=state.count></span>
    <br>
    <button on-click(handleClick)>
      <span @text="Count"></span>
      (<span @text=context.lang></span>)
    </button>
  </div>
`;var ye={};Tt(ye,{stylesheet:()=>{{return sr}},default:()=>{{return pr}},context:()=>{{return cr}}});var cr=["getUser"],sr=`
  * { font-family: helvetica }
`,pr=`
  <async await( context.getUser, 'Peter Giligous' )>
    <loading>Preloading...</loading>
    <then [response]>
      <div>
        <ul style="{ border: '1px solid black', padding: '15px' }">
          <li @text=response.name></li>
          <li @text=response.email></li>
        </ul>

        <counter initial=5 on-update(value => console.log('procount --', value ))>By</counter>
      </div>
    </then>
    <catch [error]><span @text=error></span></catch>
  </async>
`;var he={};Tt(he,{default:()=>{{return lr}},_static:()=>{{return fr}}});var fr={content:"Nexted counter component"},lr=`
  <p>
    <small style="color:gray" @text=static.content>...</small>
  </p>
`;var Ke=(t)=>{t.register("counter",me),t.register("profile",ye),t.register("footer",he)};var ot=function(t,n){if(t===n)return!1;if(typeof t!=="object"||typeof n!=="object")return!1;if(t===null||n===null)return!0;if(t instanceof Set){if(!(n instanceof Set))return!0;if(t.size!==n.size)return!0;if(Ge(t)&&Ge(n)){for(let f of t)if(!n.has(f))return!0;return!1}const c=new WeakMap;for(let f of t){let i=!1;if(typeof f!=="object"){if(n.has(f))i=!0}else for(let _ of n){if(typeof _!=="object")continue;if(!c.has(f))c.set(f,new WeakMap);const y=c.get(f);if(y.has(_)){if(i=y.get(_),i)break;continue}const h=!ot(f,_);if(y.set(_,h),h){i=!0;break}}if(!i)return!0}return!1}if(t instanceof Map){if(!(n instanceof Map))return!0;if(t.size!==n.size)return!0;if(Be(t)&&Be(n)){for(let[f,i]of t)if(n.get(f)!==i)return!0;return!1}const c=new WeakMap;for(let[f,i]of t){if(typeof f!=="object"){if(!n.has(f))return!0;const h=n.get(f);if(typeof i!=="object"){if(i!==h)return!0;continue}if(typeof h!=="object"||ot(i,h))return!0;continue}let _=!1,y=!1;for(let[h,b]of n){if(typeof h!=="object")continue;if(!c.has(f))c.set(f,new WeakMap);const V=c.get(f);if(V.has(h)){const[R,w]=V.get(h);if(R){_=!0,y=w;break}continue}if(!ot(f,h)){if(_=!0,y=typeof i==="object"&&typeof b==="object"?!ot(i,b):i===b,V.set(h,[!0,y]),y)break}else V.set(h,[!1,!1])}if(!_||!y)return!0}return!1}if(Array.isArray(t)){if(!Array.isArray(n))return!0;if(t.length!==n.length)return!0;for(let c=0;c<t.length;c++){const f=t[c],i=n[c];if(f!==i&&(typeof f!=="object"||ot(f,i)))return!0}return!1}const r=Object.keys(t),o=Object.keys(n);if(r.length!==o.length)return!0;r.sort(),o.sort();const p=r.length;for(let c=0;c<p;c++)if(r[c]!==o[c])return!0;for(let c=0;c<p;c++){const f=r[c],i=t[f],_=n[f];if(i===_)continue;if(i instanceof Date){if(!(_ instanceof Date)||String(i)!==String(_))return!0;continue}if(i instanceof RegExp){if(!(_ instanceof RegExp)||i.source!==_.source||i.flags!==_.flags)return!0;continue}if(i instanceof Map){if(!(_ instanceof Map)||ot(i,_))return!0;continue}if(i instanceof Set){if(!(_ instanceof Set)||ot(i,_))return!0;continue}if(i instanceof Function){if(!(_ instanceof Function))return!0;continue}if(typeof i==="object"){if(typeof _!=="object")return!0;if(i===t){if(_!==n)return!0}else if(ot(i,_))return!0}else return!0}return!1},St=function(t,n){if(t===n)return!0;if(t==null||n==null)return t===n;const r=typeof t;if(r!==typeof n)return!1;if(r!=="object"){if(r==="number"&&isNaN(t)&&isNaN(n))return!0;return!1}if(t instanceof Date)return n instanceof Date&&t.getTime()===n.getTime();if(t instanceof RegExp)return n instanceof RegExp&&t.source===n.source&&t.flags===n.flags;if(t instanceof Error)return n instanceof Error&&t.name===n.name&&t.message===n.message&&(t.stack===n.stack||!t.stack&&!n.stack);if(typeof ArrayBuffer!=="undefined"&&ArrayBuffer.isView(t)){if(!ArrayBuffer.isView(n))return!1;if(t.byteLength!==n.byteLength)return!1;const f=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),i=new Uint8Array(n.buffer,n.byteOffset,n.byteLength);for(let _=0;_<f.length;_++)if(f[_]!==i[_])return!1;return!0}if(t instanceof Promise||t instanceof WeakMap||t instanceof WeakSet)return t===n;if(typeof t==="function"){if(typeof n!=="function")return!1;return t.toString()===n.toString()&&t.name===n.name}if(t.constructor!==n.constructor)return!1;if(t instanceof Map||t instanceof Set||Array.isArray(t)||Object.getPrototypeOf(t)===Object.prototype)return!ot(t,n);const o=Object.getPrototypeOf(t);if(o!==Object.getPrototypeOf(n))return!1;const p=Object.getOwnPropertyNames(t),c=Object.getOwnPropertyNames(n);if(p.length!==c.length)return!1;for(let f of p){if(!Object.prototype.hasOwnProperty.call(n,f))return!1;if(!St(t[f],n[f]))return!1}if(o!==null&&o!==Object.prototype){const f=Object.getOwnPropertyNames(o),i=Object.getOwnPropertyNames(Object.getPrototypeOf(n));if(f.length!==i.length)return!1;for(let _ of f){if(_==="constructor")continue;if(!St(o[_],Object.getPrototypeOf(n)[_]))return!1}}return!0},nt=function(t,n=new WeakMap){if(t===null||typeof t!=="object"||t instanceof Promise)return t;if(n.has(t))return n.get(t);if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t.source,t.flags);if(t instanceof Map){const p=new Map;return n.set(t,p),t.forEach((c,f)=>p.set(nt(f,n),nt(c,n))),p}if(t instanceof Set){const p=new Set;return n.set(t,p),t.forEach((c)=>p.add(nt(c,n))),p}if(Array.isArray(t)){const p=[];n.set(t,p);for(let c=0;c<t.length;c++)p[c]=nt(t[c],n);return p}if(ArrayBuffer.isView(t))return new t.constructor(t);const r=Object.create(Object.getPrototypeOf(t));n.set(t,r);const o=Object.getOwnPropertySymbols(t);for(let p of o)r[p]=nt(t[p],n);for(let p in t)if(Object.prototype.hasOwnProperty.call(t,p))r[p]=nt(t[p],n);return r},gr=function(t,n){if(!t||typeof t!=="object")throw new TypeError("Original argument must be an object");if(!n||typeof n!=="object")throw new TypeError("ToSet argument must be an object");if(!Object.keys(n).length)return{...t};function r(p,c,f){const i=c.split(/\.|\[|\]/).filter(Boolean);let _=p;for(let y=0;y<i.length;y++){const h=i[y],b=!isNaN(Number(h)),V=y===i.length-1,R=!isNaN(Number(i[y+1]));if(V){_[h]=f;continue}if(!(h in _))_[h]=R?[]:{};else if(R&&!Array.isArray(_[h]))_[h]=[];else if(!R&&Array.isArray(_[h]))_[h]={};_=_[h]}}const o=nt(t);try{for(let[p,c]of Object.entries(n)){if(typeof p!=="string")throw new TypeError(`Invalid path: ${p}`);if(!/^[a-zA-Z0-9_\-\[\].]+$/.test(p))throw new Error(`Invalid path format: ${p}`);r(o,p,c)}}catch(p){throw new Error(`Failed to assign value: ${p.message}`)}return o},un=function(t){return t.trim()},qt=function(t,n,r){return t.replace(n,r)},Tr=function(t,n,r){return t.indexOf(n,r)},Pt=function(t,n){return t.charCodeAt(n)|0},Dt=function(t,n,r){return t.slice(n,r)},vt=function(t){return t.length},cn=function(t){return t.length},Bt=function(t,n){return n.push(t),t},xe=function(t,n,r,o,p,c,f,i){return{value:t,root:n,parent:r,type:o,props:p,children:c,line:Jt,column:Vt,length:f,return:"",siblings:i}},Sr=function(){return tt},Er=function(){if(tt=_t>0?Pt(Lt,--_t):0,Vt--,tt===10)Vt=1,Jt--;return tt},yt=function(){if(tt=_t<pn?Pt(Lt,_t++):0,Vt++,tt===10)Vt=1,Jt++;return tt},xt=function(){return Pt(Lt,_t)},Yt=function(){return _t},Zt=function(t,n){return Dt(Lt,t,n)},It=function(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0},Rr=function(t){return Jt=Vt=1,pn=vt(Lt=t),_t=0,[]},Nr=function(t){return Lt="",t},ge=function(t){return un(Zt(_t-1,be(t===91?t+2:t===40?t+1:t)))},jr=function(t){while(tt=xt())if(tt<33)yt();else break;return It(t)>2||It(tt)>3?"":" "},Pr=function(t,n){while(--n&&yt())if(tt<48||tt>102||tt>57&&tt<65||tt>70&&tt<97)break;return Zt(t,Yt()+(n<6&&xt()==32&&yt()==32))},be=function(t){while(yt())switch(tt){case t:return _t;case 34:case 39:if(t!==34&&t!==39)be(tt);break;case 40:if(t===41)be(t);break;case 92:yt();break}return _t},Dr=function(t,n){while(yt())if(t+tt===57)break;else if(t+tt===84&&xt()===47)break;return"/*"+Zt(n,_t-1)+"*"+$e(t===47?t:yt())},Vr=function(t){while(!It(xt()))yt();return Zt(t,_t)},Lr=function(t){return Nr(Ht("",null,null,null,[""],t=Rr(t),0,[0],t))},Ht=function(t,n,r,o,p,c,f,i,_){var y=0,h=0,b=f,V=0,R=0,w=0,q=1,et=1,X=1,H=0,K="",I=p,U=c,x=o,P=K;while(et)switch(w=H,H=yt()){case 40:if(w!=108&&Pt(P,b-1)==58){if(Tr(P+=qt(ge(H),"&","&\f"),"&\f",sn(y?i[y-1]:0))!=-1)X=-1;break}case 34:case 39:case 91:P+=ge(H);break;case 9:case 10:case 13:case 32:P+=jr(w);break;case 92:P+=Pr(Yt()-1,7);continue;case 47:switch(xt()){case 42:case 47:if(Bt(Or(Dr(yt(),Yt()),n,r,_),_),(It(w||1)==5||It(xt()||1)==5)&&vt(P)&&Dt(P,-1,void 0)!==" ")P+=" ";break;default:P+="/"}break;case 123*q:i[y++]=vt(P)*X;case 125*q:case 59:case 0:switch(H){case 0:case 125:et=0;case 59+h:if(X==-1)P=qt(P,/\f/g,"");if(R>0&&(vt(P)-b||q===0&&w===47))Bt(R>32?Ye(P+";",o,r,b-1,_):Ye(qt(P," ","")+";",o,r,b-2,_),_);break;case 59:P+=";";default:if(Bt(x=qe(P,n,r,y,h,p,i,K,I=[],U=[],b,c),c),H===123)if(h===0)Ht(P,n,x,x,I,c,b,i,U);else{switch(V){case 99:if(Pt(P,3)===110)break;case 108:if(Pt(P,2)===97)break;default:h=0;case 100:case 109:case 115:}if(h)Ht(t,x,x,o&&Bt(qe(t,x,x,0,0,p,i,K,p,I=[],b,U),U),p,U,b,i,o?I:U);else Ht(P,x,x,x,[""],U,0,i,U)}}y=h=R=0,q=X=1,K=P="",b=f;break;case 58:b=1+vt(P),R=w;default:if(q<1){if(H==123)--q;else if(H==125&&q++==0&&Er()==125)continue}switch(P+=$e(H),H*q){case 38:X=h>0?1:(P+="\f",-1);break;case 44:i[y++]=(vt(P)-1)*X,X=1;break;case 64:if(xt()===45)P+=ge(yt());V=xt(),h=b=vt(K=P+=Vr(Yt())),H++;break;case 45:if(w===45&&vt(P)==2)q=0}}return c},qe=function(t,n,r,o,p,c,f,i,_,y,h,b){var V=p-1,R=p===0?c:[""],w=cn(R);for(var q=0,et=0,X=0;q<o;++q)for(var H=0,K=Dt(t,V+1,V=sn(et=f[q])),I=t;H<w;++H)if(I=un(et>0?R[H]+" "+K:qt(K,/&\f/g,R[H])))_[X++]=I;return xe(t,n,r,p===0?an:i,_,y,h,b)},Or=function(t,n,r,o){return xe(t,n,r,rn,$e(Sr()),Dt(t,2,-2),0,o)},Ye=function(t,n,r,o,p){return xe(t,n,r,on,Dt(t,0,o),Dt(t,o+1,-1),o,p)},Ae=function(t,n){var r="";for(var o=0;o<t.length;o++)r+=n(t[o],o,t,n)||"";return r},Mr=function(t,n,r,o){switch(t.type){case Cr:if(t.children.length)break;case Ar:case $r:case on:return t.return=t.return||t.value;case rn:return"";case xr:return t.return=t.value+"{"+Ae(t.children,o)+"}";case an:if(!vt(t.value=t.props.join(",")))return""}return vt(r=Ae(t.children,o))?t.return=t.value+"{"+r+"}":""},Fr=function(t){var n=cn(t);return function(r,o,p,c){var f="";for(var i=0;i<n;i++)f+=t[i](r,o,p,c)||"";return f}},Gr=function(t){if(/\bstate\.|\binput\.|\bself\.|\bcontext\./.test(t))return!0;if(/[\+\*\/\%\(\)\{\}\[\]]|\?\s*:/.test(t))return!0;if(/\b[a-zA-Z_][a-zA-Z0-9_]*\.[a-zA-Z_]/.test(t))return!0;if(t.includes("{")&&t.includes("}"))return!0;return!1},He=function(t){let n=(t||"").trim().replace(/>\s*</g,"><").replace(/\s{2,}/g," ").replace(/[\r\n\t]/g,"").replace(/<([a-zA-Z0-9_-]+)([^>]*?)\s*\/>/g,"<$1$2></$1>").replace(/<\{([^}]+)\}\s*(.*?)\/>/g,'<lips dtag="$1" $2></lips>').replace(/(<>)([\s\S]*?)(<\/>)/g,'<lips fragment="true">$2</lips>').replace(/<if\(\s*(.*?)\s*\)>/g,'<if @by="$1">').replace(/<else-if\(\s*(.*?)\s*\)>/g,'<else-if @by="$1">').replace(/<switch\(\s*(.*?)\s*\)>/g,'<switch @by="$1">').replace(/<async await\(\s*(.*?)\s*\)>/g,`<async ${kt}await="$1">`).replace(/<log\(\s*(.*?)\s*\)>/g,'<log @args="$1">').replace(/\[(.*?)\]/g,(r)=>r.replace(/\s+/g,""));return n=Ir(n),n=Ur(n),n},zt=function(t,n={maxSize:100}){const r=new Set,o=[{value:t,timestamp:Date.now()}];let p=0;const c=()=>{const i=Xt[Xt.length-1];return i&&Br(i,r),o[p].value},f=()=>{const i=[...r];if(Xe)for(let _ of i)Xe.add(_);else for(let _ of i)_.execute()};return[c,(i,_)=>{if(Object.is(o[p].value,i))return;if(p<o.length-1)o.splice(p+1);if(o.push({value:i,timestamp:Date.now(),metadata:_}),o.length>n.maxSize)o.shift(),p=Math.max(0,p-1);else p++;f()},{undo(){if(p>0)p--,f()},redo(){if(p<o.length-1)p++,f()},jumpTo(i){if(i>=0&&i<o.length&&i!==p)p=i,f()},getHistory(){return[...o]},getCurrentIndex(){return p},canUndo(){return p>0},canRedo(){return p<o.length-1},clear(){const i=o[0];o.length=0,o.push(i),p=0,f()}}]},ln=function(t){let n=!1;const r=()=>{if(n)throw new Error("Circular dependency detected");if(o.isDisposed)return;n=!0,ze(o),Xt.push(o);try{t()}finally{n=!1,Xt.pop()}},o={execute:r,dependencies:new Set,isDisposed:!1};return r(),{dispose:()=>{o.isDisposed=!0,ze(o)}}},_r=Object.create,{defineProperty:ke,getPrototypeOf:dr,getOwnPropertyNames:mr}=Object,yr=Object.prototype.hasOwnProperty,Wt=(t,n,r)=>{r=t!=null?_r(dr(t)):{};const o=n||!t||!t.__esModule?ke(r,"default",{value:t,enumerable:!0}):r;for(let p of mr(t))if(!yr.call(o,p))ke(o,p,{get:()=>t[p],enumerable:!0});return o},hr=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports),Ut=(t,n)=>{for(var r in n)ke(t,r,{get:n[r],enumerable:!0,configurable:!0,set:(o)=>n[r]=()=>o})},Qt=hr((t,n)=>{(function(){var r=document,o=window,p=r.documentElement,c=r.createElement.bind(r),f=c("div"),i=c("table"),_=c("tbody"),y=c("tr"),h=Array.isArray,b=Array.prototype,V=b.concat,R=b.filter,w=b.indexOf,q=b.map,et=b.push,X=b.slice,H=b.some,K=b.splice,I=/^#(?:[\w-]|\\.|[^\x00-\xa0])*$/,U=/^\.(?:[\w-]|\\.|[^\x00-\xa0])*$/,x=/<.+>/,P=/^\w+$/;function l(e,a){var u=j(a);return!e||!u&&!B(a)&&!$(a)?[]:!u&&U.test(e)?a.getElementsByClassName(e.slice(1).replace(/\\/g,"")):!u&&P.test(e)?a.getElementsByTagName(e):a.querySelectorAll(e)}var N=function(){function e(a,u){if(!a)return;if(E(a))return a;var d=a;if(S(a)){var v=u||r;if(d=I.test(a)&&B(v)?v.getElementById(a.slice(1).replace(/\\/g,"")):x.test(a)?Ee(a):E(v)?v.find(a):S(v)?m(v).find(a):l(a,v),!d)return}else if(D(a))return this.ready(a);if(d.nodeType||d===o)d=[d];this.length=d.length;for(var A=0,L=this.length;A<L;A++)this[A]=d[A]}return e.prototype.init=function(a,u){return new e(a,u)},e}(),s=N.prototype,m=s.init;if(m.fn=m.prototype=s,s.length=0,s.splice=K,typeof Symbol==="function")s[Symbol.iterator]=b[Symbol.iterator];function E(e){return e instanceof N}function T(e){return!!e&&e===e.window}function B(e){return!!e&&e.nodeType===9}function j(e){return!!e&&e.nodeType===11}function $(e){return!!e&&e.nodeType===1}function O(e){return!!e&&e.nodeType===3}function C(e){return typeof e==="boolean"}function D(e){return typeof e==="function"}function S(e){return typeof e==="string"}function k(e){return e===void 0}function g(e){return e===null}function M(e){return!isNaN(parseFloat(e))&&isFinite(e)}function z(e){if(typeof e!=="object"||e===null)return!1;var a=Object.getPrototypeOf(e);return a===null||a===Object.prototype}m.isWindow=T,m.isFunction=D,m.isArray=h,m.isNumeric=M,m.isPlainObject=z;function F(e,a,u){if(u){var d=e.length;while(d--)if(a.call(e[d],d,e[d])===!1)return e}else if(z(e)){var v=Object.keys(e);for(var d=0,A=v.length;d<A;d++){var L=v[d];if(a.call(e[L],L,e[L])===!1)return e}}else for(var d=0,A=e.length;d<A;d++)if(a.call(e[d],d,e[d])===!1)return e;return e}m.each=F,s.each=function(e){return F(this,e)},s.empty=function(){return this.each(function(e,a){while(a.firstChild)a.removeChild(a.firstChild)})};function Y(){var e=[];for(var a=0;a<arguments.length;a++)e[a]=arguments[a];var u=C(e[0])?e.shift():!1,d=e.shift(),v=e.length;if(!d)return{};if(!v)return Y(u,m,d);for(var A=0;A<v;A++){var L=e[A];for(var G in L)if(u&&(h(L[G])||z(L[G]))){if(!d[G]||d[G].constructor!==L[G].constructor)d[G]=new L[G].constructor;Y(u,d[G],L[G])}else d[G]=L[G]}return d}m.extend=Y,s.extend=function(e){return Y(s,e)};var W=/\S+/g;function ut(e){return S(e)?e.match(W)||[]:[]}s.toggleClass=function(e,a){var u=ut(e),d=!k(a);return this.each(function(v,A){if(!$(A))return;F(u,function(L,G){if(d)a?A.classList.add(G):A.classList.remove(G);else A.classList.toggle(G)})})},s.addClass=function(e){return this.toggleClass(e,!0)},s.removeAttr=function(e){var a=ut(e);return this.each(function(u,d){if(!$(d))return;F(a,function(v,A){d.removeAttribute(A)})})};function Z(e,a){if(!e)return;if(S(e)){if(arguments.length<2){if(!this[0]||!$(this[0]))return;var u=this[0].getAttribute(e);return g(u)?void 0:u}if(k(a))return this;if(g(a))return this.removeAttr(e);return this.each(function(v,A){if(!$(A))return;A.setAttribute(e,a)})}for(var d in e)this.attr(d,e[d]);return this}s.attr=Z,s.removeClass=function(e){if(arguments.length)return this.toggleClass(e,!1);return this.attr("class","")},s.hasClass=function(e){return!!e&&H.call(this,function(a){return $(a)&&a.classList.contains(e)})},s.get=function(e){if(k(e))return X.call(this);return e=Number(e),this[e<0?e+this.length:e]},s.eq=function(e){return m(this.get(e))},s.first=function(){return this.eq(0)},s.last=function(){return this.eq(-1)};function it(e){if(k(e))return this.get().map(function(a){return $(a)||O(a)?a.textContent:""}).join("");return this.each(function(a,u){if(!$(u))return;u.textContent=e})}s.text=it;function ct(e,a,u){if(!$(e))return;var d=o.getComputedStyle(e,null);return u?d.getPropertyValue(a)||void 0:d[a]||e.style[a]}function st(e,a){return parseInt(ct(e,a),10)||0}function Et(e,a){return st(e,"border".concat(a?"Left":"Top","Width"))+st(e,"padding".concat(a?"Left":"Top"))+st(e,"padding".concat(a?"Right":"Bottom"))+st(e,"border".concat(a?"Right":"Bottom","Width"))}var lt={};function Rt(e){if(lt[e])return lt[e];var a=c(e);r.body.insertBefore(a,null);var u=ct(a,"display");return r.body.removeChild(a),lt[e]=u!=="none"?u:"block"}function Nt(e){return ct(e,"display")==="none"}function Mt(e,a){var u=e&&(e.matches||e.webkitMatchesSelector||e.msMatchesSelector);return!!u&&!!a&&u.call(e,a)}function Kt(e){return S(e)?function(a,u){return Mt(u,e)}:D(e)?e:E(e)?function(a,u){return e.is(u)}:!e?function(){return!1}:function(a,u){return u===e}}s.filter=function(e){var a=Kt(e);return m(R.call(this,function(u,d){return a.call(u,d,u)}))};function bt(e,a){return!a?e:e.filter(a)}s.detach=function(e){return bt(this,e).each(function(a,u){if(u.parentNode)u.parentNode.removeChild(u)}),this};var kn=/^\s*<(\w+)[^>]*>/,bn=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,Se={"*":f,tr:_,td:y,th:y,thead:i,tbody:i,tfoot:i};function Ee(e){if(!S(e))return[];if(bn.test(e))return[c(RegExp.$1)];var a=kn.test(e)&&RegExp.$1,u=Se[a]||Se["*"];return u.innerHTML=e,m(u.childNodes).detach().get()}m.parseHTML=Ee,s.has=function(e){var a=S(e)?function(u,d){return l(e,d).length}:function(u,d){return d.contains(e)};return this.filter(a)},s.not=function(e){var a=Kt(e);return this.filter(function(u,d){return(!S(e)||$(d))&&!a.call(d,u,d)})};function gt(e,a,u,d){var v=[],A=D(a),L=d&&Kt(d);for(var G=0,dt=e.length;G<dt;G++)if(A){var rt=a(e[G]);if(rt.length)et.apply(v,rt)}else{var pt=e[G][a];while(pt!=null){if(d&&L(-1,pt))break;v.push(pt),pt=u?pt[a]:null}}return v}function Re(e){if(e.multiple&&e.options)return gt(R.call(e.options,function(a){return a.selected&&!a.disabled&&!a.parentNode.disabled}),"value");return e.value||""}function An(e){if(!arguments.length)return this[0]&&Re(this[0]);return this.each(function(a,u){var d=u.multiple&&u.options;if(d||Ue.test(u.type)){var v=h(e)?q.call(e,String):g(e)?[]:[String(e)];if(d)F(u.options,function(A,L){L.selected=v.indexOf(L.value)>=0},!0);else u.checked=v.indexOf(u.value)>=0}else u.value=k(e)||g(e)?"":e})}s.val=An,s.is=function(e){var a=Kt(e);return H.call(this,function(u,d){return a.call(u,d,u)})},m.guid=1;function ht(e){return e.length>1?R.call(e,function(a,u,d){return w.call(d,a)===u}):e}m.unique=ht,s.add=function(e,a){return m(ht(this.get().concat(m(e,a).get())))},s.children=function(e){return bt(m(ht(gt(this,function(a){return a.children}))),e)},s.parent=function(e){return bt(m(ht(gt(this,"parentNode"))),e)},s.index=function(e){var a=e?m(e)[0]:this[0],u=e?this:m(a).parent().children();return w.call(u,a)},s.closest=function(e){var a=this.filter(e);if(a.length)return a;var u=this.parent();if(!u.length)return a;return u.closest(e)},s.siblings=function(e){return bt(m(ht(gt(this,function(a){return m(a).parent().children().not(a)}))),e)},s.find=function(e){return m(ht(gt(this,function(a){return l(e,a)})))};var $n=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,xn=/^$|^module$|\/(java|ecma)script/i,Cn=["type","src","nonce","noModule"];function Tn(e,a){var u=m(e);u.filter("script").add(u.find("script")).each(function(d,v){if(xn.test(v.type)&&p.contains(v)){var A=c("script");A.text=v.textContent.replace($n,""),F(Cn,function(L,G){if(v[G])A[G]=v[G]}),a.head.insertBefore(A,null),a.head.removeChild(A)}})}function Sn(e,a,u,d,v){if(d)e.insertBefore(a,u?e.firstChild:null);else if(e.nodeName==="HTML")e.parentNode.replaceChild(a,e);else e.parentNode.insertBefore(a,u?e:e.nextSibling);if(v)Tn(a,e.ownerDocument)}function At(e,a,u,d,v,A,L,G){return F(e,function(dt,rt){F(m(rt),function(pt,Ct){F(m(a),function(mt,Gt){var ue=u?Ct:Gt,ce=u?Gt:Ct,ft=u?pt:mt;Sn(ue,!ft?ce:ce.cloneNode(!0),d,v,!ft)},G)},L)},A),a}s.after=function(){return At(arguments,this,!1,!1,!1,!0,!0)},s.append=function(){return At(arguments,this,!1,!1,!0)};function En(e){if(!arguments.length)return this[0]&&this[0].innerHTML;if(k(e))return this;var a=/<script[\s>]/.test(e);return this.each(function(u,d){if(!$(d))return;if(a)m(d).empty().append(e);else d.innerHTML=e})}s.html=En,s.appendTo=function(e){return At(arguments,this,!0,!1,!0)},s.wrapInner=function(e){return this.each(function(a,u){var d=m(u),v=d.contents();v.length?v.wrapAll(e):d.append(e)})},s.before=function(){return At(arguments,this,!1,!0)},s.wrapAll=function(e){var a=m(e),u=a[0];while(u.children.length)u=u.firstElementChild;return this.first().before(a),this.appendTo(u)},s.wrap=function(e){return this.each(function(a,u){var d=m(e)[0];m(u).wrapAll(!a?d:d.cloneNode(!0))})},s.insertAfter=function(e){return At(arguments,this,!0,!1,!1,!1,!1,!0)},s.insertBefore=function(e){return At(arguments,this,!0,!0)},s.prepend=function(){return At(arguments,this,!1,!0,!0,!0,!0)},s.prependTo=function(e){return At(arguments,this,!0,!0,!0,!1,!1,!0)},s.contents=function(){return m(ht(gt(this,function(e){return e.tagName==="IFRAME"?[e.contentDocument]:e.tagName==="TEMPLATE"?e.content.childNodes:e.childNodes})))},s.next=function(e,a,u){return bt(m(ht(gt(this,"nextElementSibling",a,u))),e)},s.nextAll=function(e){return this.next(e,!0)},s.nextUntil=function(e,a){return this.next(a,!0,e)},s.parents=function(e,a){return bt(m(ht(gt(this,"parentElement",!0,a))),e)},s.parentsUntil=function(e,a){return this.parents(a,e)},s.prev=function(e,a,u){return bt(m(ht(gt(this,"previousElementSibling",a,u))),e)},s.prevAll=function(e){return this.prev(e,!0)},s.prevUntil=function(e,a){return this.prev(a,!0,e)},s.map=function(e){return m(V.apply([],q.call(this,function(a,u){return e.call(a,u,a)})))},s.clone=function(){return this.map(function(e,a){return a.cloneNode(!0)})},s.offsetParent=function(){return this.map(function(e,a){var u=a.offsetParent;while(u&&ct(u,"position")==="static")u=u.offsetParent;return u||p})},s.slice=function(e,a){return m(X.call(this,e,a))};var Rn=/-([a-z])/g;function te(e){return e.replace(Rn,function(a,u){return u.toUpperCase()})}s.ready=function(e){var a=function(){return setTimeout(e,0,m)};if(r.readyState!=="loading")a();else r.addEventListener("DOMContentLoaded",a);return this},s.unwrap=function(){return this.parent().each(function(e,a){if(a.tagName==="BODY")return;var u=m(a);u.replaceWith(u.children())}),this},s.offset=function(){var e=this[0];if(!e)return;var a=e.getBoundingClientRect();return{top:a.top+o.pageYOffset,left:a.left+o.pageXOffset}},s.position=function(){var e=this[0];if(!e)return;var a=ct(e,"position")==="fixed",u=a?e.getBoundingClientRect():this.offset();if(!a){var d=e.ownerDocument,v=e.offsetParent||d.documentElement;while((v===d.body||v===d.documentElement)&&ct(v,"position")==="static")v=v.parentNode;if(v!==e&&$(v)){var A=m(v).offset();u.top-=A.top+st(v,"borderTopWidth"),u.left-=A.left+st(v,"borderLeftWidth")}}return{top:u.top-st(e,"marginTop"),left:u.left-st(e,"marginLeft")}};var Ne={class:"className",contenteditable:"contentEditable",for:"htmlFor",readonly:"readOnly",maxlength:"maxLength",tabindex:"tabIndex",colspan:"colSpan",rowspan:"rowSpan",usemap:"useMap"};s.prop=function(e,a){if(!e)return;if(S(e)){if(e=Ne[e]||e,arguments.length<2)return this[0]&&this[0][e];return this.each(function(d,v){v[e]=a})}for(var u in e)this.prop(u,e[u]);return this},s.removeProp=function(e){return this.each(function(a,u){delete u[Ne[e]||e]})};var Nn=/^--/;function ee(e){return Nn.test(e)}var ne={},jn=f.style,Pn=["webkit","moz","ms"];function Dn(e,a){if(a===void 0)a=ee(e);if(a)return e;if(!ne[e]){var u=te(e),d="".concat(u[0].toUpperCase()).concat(u.slice(1)),v="".concat(u," ").concat(Pn.join("".concat(d," "))).concat(d).split(" ");F(v,function(A,L){if(L in jn)return ne[e]=L,!1})}return ne[e]}var Vn={animationIterationCount:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0};function je(e,a,u){if(u===void 0)u=ee(e);return!u&&!Vn[e]&&M(a)?"".concat(a,"px"):a}function Ln(e,a){if(S(e)){var u=ee(e);if(e=Dn(e,u),arguments.length<2)return this[0]&&ct(this[0],e,u);if(!e)return this;return a=je(e,a,u),this.each(function(v,A){if(!$(A))return;if(u)A.style.setProperty(e,a);else A.style[e]=a})}for(var d in e)this.css(d,e[d]);return this}s.css=Ln;function Pe(e,a){try{return e(a)}catch(u){return a}}var On=/^\s+|\s+$/;function De(e,a){var u=e.dataset[a]||e.dataset[te(a)];if(On.test(u))return u;return Pe(JSON.parse,u)}function Mn(e,a,u){u=Pe(JSON.stringify,u),e.dataset[te(a)]=u}function Fn(e,a){if(!e){if(!this[0])return;var u={};for(var d in this[0].dataset)u[d]=De(this[0],d);return u}if(S(e)){if(arguments.length<2)return this[0]&&De(this[0],e);if(k(a))return this;return this.each(function(v,A){Mn(A,e,a)})}for(var d in e)this.data(d,e[d]);return this}s.data=Fn;function Ve(e,a){var u=e.documentElement;return Math.max(e.body["scroll".concat(a)],u["scroll".concat(a)],e.body["offset".concat(a)],u["offset".concat(a)],u["client".concat(a)])}F([!0,!1],function(e,a){F(["Width","Height"],function(u,d){var v="".concat(a?"outer":"inner").concat(d);s[v]=function(A){if(!this[0])return;if(T(this[0]))return a?this[0]["inner".concat(d)]:this[0].document.documentElement["client".concat(d)];if(B(this[0]))return Ve(this[0],d);return this[0]["".concat(a?"offset":"client").concat(d)]+(A&&a?st(this[0],"margin".concat(u?"Top":"Left"))+st(this[0],"margin".concat(u?"Bottom":"Right")):0)}})}),F(["Width","Height"],function(e,a){var u=a.toLowerCase();s[u]=function(d){if(!this[0])return k(d)?void 0:this;if(!arguments.length){if(T(this[0]))return this[0].document.documentElement["client".concat(a)];if(B(this[0]))return Ve(this[0],a);return this[0].getBoundingClientRect()[u]-Et(this[0],!e)}var v=parseInt(d,10);return this.each(function(A,L){if(!$(L))return;var G=ct(L,"boxSizing");L.style[u]=je(u,v+(G==="border-box"?Et(L,!e):0))})}});var Le="___cd";s.toggle=function(e){return this.each(function(a,u){if(!$(u))return;var d=Nt(u),v=k(e)?d:e;if(v){if(u.style.display=u[Le]||"",Nt(u))u.style.display=Rt(u.tagName)}else if(!d)u[Le]=ct(u,"display"),u.style.display="none"})},s.hide=function(){return this.toggle(!1)},s.show=function(){return this.toggle(!0)};var Oe="___ce",re=".",ie={focus:"focusin",blur:"focusout"},Me={mouseenter:"mouseover",mouseleave:"mouseout"},In=/^(mouse|pointer|contextmenu|drag|drop|click|dblclick)/i;function ae(e){return Me[e]||ie[e]||e}function oe(e){var a=e.split(re);return[a[0],a.slice(1).sort()]}s.trigger=function(e,a){if(S(e)){var u=oe(e),d=u[0],v=u[1],A=ae(d);if(!A)return this;var L=In.test(A)?"MouseEvents":"HTMLEvents";e=r.createEvent(L),e.initEvent(A,!0,!0),e.namespace=v.join(re),e.___ot=d}e.___td=a;var G=e.___ot in ie;return this.each(function(dt,rt){if(G&&D(rt[e.___ot]))rt["___i".concat(e.type)]=!0,rt[e.___ot](),rt["___i".concat(e.type)]=!1;rt.dispatchEvent(e)})};function Fe(e){return e[Oe]=e[Oe]||{}}function Un(e,a,u,d,v){var A=Fe(e);A[a]=A[a]||[],A[a].push([u,d,v]),e.addEventListener(a,v)}function Ie(e,a){return!a||!H.call(a,function(u){return e.indexOf(u)<0})}function wt(e,a,u,d,v){var A=Fe(e);if(!a)for(a in A)wt(e,a,u,d,v);else if(A[a])A[a]=A[a].filter(function(L){var G=L[0],dt=L[1],rt=L[2];if(v&&rt.guid!==v.guid||!Ie(G,u)||d&&d!==dt)return!0;e.removeEventListener(a,rt)})}s.off=function(e,a,u){var d=this;if(k(e))this.each(function(A,L){if(!$(L)&&!B(L)&&!T(L))return;wt(L)});else if(!S(e))for(var v in e)this.off(v,e[v]);else{if(D(a))u=a,a="";F(ut(e),function(A,L){var G=oe(L),dt=G[0],rt=G[1],pt=ae(dt);d.each(function(Ct,mt){if(!$(mt)&&!B(mt)&&!T(mt))return;wt(mt,pt,rt,a,u)})})}return this},s.remove=function(e){return bt(this,e).detach().off(),this},s.replaceWith=function(e){return this.before(e).remove()},s.replaceAll=function(e){return m(e).replaceWith(this),this};function Kn(e,a,u,d,v){var A=this;if(!S(e)){for(var L in e)this.on(L,a,u,e[L],v);return this}if(!S(a))if(k(a)||g(a))a="";else if(k(u))u=a,a="";else d=u,u=a,a="";if(!D(d))d=u,u=void 0;if(!d)return this;return F(ut(e),function(G,dt){var rt=oe(dt),pt=rt[0],Ct=rt[1],mt=ae(pt),Gt=pt in Me,ue=pt in ie;if(!mt)return;A.each(function(ce,ft){if(!$(ft)&&!B(ft)&&!T(ft))return;var se=function(at){if(at.target["___i".concat(at.type)])return at.stopImmediatePropagation();if(at.namespace&&!Ie(Ct,at.namespace.split(re)))return;if(!a&&(ue&&(at.target!==ft||at.___ot===mt)||Gt&&at.relatedTarget&&ft.contains(at.relatedTarget)))return;var pe=ft;if(a){var jt=at.target;while(!Mt(jt,a)){if(jt===ft)return;if(jt=jt.parentNode,!jt)return}pe=jt}Object.defineProperty(at,"currentTarget",{configurable:!0,get:function(){return pe}}),Object.defineProperty(at,"delegateTarget",{configurable:!0,get:function(){return ft}}),Object.defineProperty(at,"data",{configurable:!0,get:function(){return u}});var Yn=d.call(pe,at,at.___td);if(v)wt(ft,mt,Ct,a,se);if(Yn===!1)at.preventDefault(),at.stopPropagation()};se.guid=d.guid=d.guid||m.guid++,Un(ft,mt,Ct,a,se)})}),this}s.on=Kn;function wn(e,a,u,d){return this.on(e,a,u,d,!0)}s.one=wn;var Gn=/\r?\n/g;function Bn(e,a){return"&".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(a.replace(Gn,"\r\n")))}var qn=/file|reset|submit|button|image/i,Ue=/radio|checkbox/i;if(s.serialize=function(){var e="";return this.each(function(a,u){F(u.elements||[u],function(d,v){if(v.disabled||!v.name||v.tagName==="FIELDSET"||qn.test(v.type)||Ue.test(v.type)&&!v.checked)return;var A=Re(v);if(!k(A)){var L=h(A)?A:[A];F(L,function(G,dt){e+=Bn(v.name,dt)})}})}),e.slice(1)},typeof t!=="undefined")n.exports=m;else o.cash=o.$=m})()}),vr=Wt(Qt(),1);class We{default=window.navigator.language;LANGUAGE_DICTIONARIES={};setLang(t){if(this.default!==t)return this.default=t,!0;return!1}setDictionary(t,n){this.LANGUAGE_DICTIONARIES[t]=n}translate(t,n){if(n&&this.default==n)return{text:t,lang:this.default};n=n||this.default;const[r,o]=n.split("-");if(this.LANGUAGE_DICTIONARIES[r]&&t in this.LANGUAGE_DICTIONARIES[r]){if(typeof this.LANGUAGE_DICTIONARIES[r][t]==="object"){const p=this.LANGUAGE_DICTIONARIES[r][t];t=p[o||"*"]||p["*"]}else if(typeof this.LANGUAGE_DICTIONARIES[r][t]==="string")t=this.LANGUAGE_DICTIONARIES[r][t]}return{text:t,lang:n}}propagate(t){const n=this;function r(){const o=vr.default(this),p=o.html(),c=o.attr("title"),f=o.attr("placeholder");let i;if(!/<\//.test(p)&&o.text()){const{text:_,lang:y}=n.translate(o.text());o.text(_),i=y}if(c){const{text:_,lang:y}=n.translate(c);o.attr("title",_),i=y}if(f){const{text:_,lang:y}=n.translate(f);o.attr("placeholder",_),i=y}i&&o.attr("lang",i)}return t.children().each(r),t}}class Qe{pendingComponents=new Set;isPending=!1;callbacks=new Map;register(t,n){this.callbacks.set(t,n)}unregister(t){this.callbacks.delete(t)}queue(t){if(!this.callbacks.has(t))return;if(this.pendingComponents.add(t),!this.isPending)this.isPending=!0,this.schedule()}schedule(){Promise.resolve().then(()=>this.process())}process(){const t=Array.from(this.pendingComponents);this.pendingComponents.clear(),this.isPending=!1,t.forEach((n)=>{try{const r=this.callbacks.get(n);if(r)r()}catch(r){console.error(`Error updating component ${n}:`,r)}})}clear(){this.pendingComponents.clear(),this.isPending=!1}dispose(){this.pendingComponents.clear(),this.callbacks.clear(),this.isPending=!1}}class Ze{subscriptions=new Map;tick=new Qe;register(t,n){this.subscriptions.set(t,n),this.tick.register(t,n)}unregister(t){this.subscriptions.delete(t),this.tick.unregister(t)}queueUpdate(t){this.tick.queue(t)}dispose(){this.subscriptions.clear(),this.tick.dispose()}prepareForPotentialUnload(){this.tick.clear(),this.subscriptions.forEach((t,n)=>{this.subscriptions.set(n,()=>{})})}proxyState(t,n){const r=this,o=new WeakMap,p=(f)=>{if(f instanceof Map)f.forEach((_,y)=>f.set(y,c(_)));else if(Array.isArray(f))f.forEach((_,y)=>f[y]=c(_));else if(typeof f==="object")Object.entries(f).forEach(([_,y])=>f[_]=c(y));let i=new Proxy(f,{get(_,y){if(y==="toJSON")return function(){const b=(V)=>{if(!V||typeof V!=="object")return V;if(o.has(V)){const R=o.get(V);if(R instanceof Map){const q={};return R.forEach((et,X)=>q[typeof X==="object"?JSON.stringify(X):String(X)]=b(et)),q}if(Array.isArray(R))return R.map((q)=>b(q));const w={};return Object.entries(R).forEach(([q,et])=>w[q]=b(et)),w}if(typeof V.toJSON==="function"&&!o.has(V))return V.toJSON();return V};return b(i)};if(y==="reset")return function(){i=null};const h=_[y];if(f instanceof Map&&typeof h==="function")return function(...b){const V=y.toString();if(V==="set"&&b.length>=2)b[1]=c(b[1]);const R=h.apply(_,b);return["set","delete","clear"].includes(V)&&r.queueUpdate(t),R};if(Array.isArray(f)&&typeof h==="function")return function(...b){const V=y.toString();if(["push","unshift"].includes(V))b=b.map((w)=>c(w));else if(V==="splice"&&b.length>2)b=[b[0],b[1],...b.slice(2).map((w)=>c(w))];const R=h.apply(_,b);return["push","pop","shift","unshift","splice","sort","reverse","fill"].includes(V)&&r.queueUpdate(t),R};return h},set(_,y,h){if(_[y]===h)return!0;if(h instanceof Map&&_[y]instanceof Map){const b=_[y];return b.clear(),h.forEach((V,R)=>b.set(R,c(V))),r.queueUpdate(t),!0}return _[y]=c(h),r.queueUpdate(t),!0}});return o.set(i,f),i},c=(f)=>{if(!f)return f;return f instanceof Map||Array.isArray(f)||typeof f==="object"?p(f):f};return p(n)}}class Je{domObserver;observedComponents=new Map;TIMEOUT=1e4;constructor(){this.domObserver=new MutationObserver(()=>{this.observedComponents.forEach((t,n)=>{try{const r=n.node;if(!r){this.unwatch(n);return}if(t.type==="attach"&&document.contains(r[0]))this.unwatch(n),n.emit("component:attached",n),typeof n.onAttach=="function"&&n.onAttach.bind(n)();else if(t.type==="detach"&&!document.contains(r[0]))this.unwatch(n),n.emit("component:detached",n),typeof n.onDetach=="function"&&n.onDetach.bind(n)()}catch(r){console.log("DWS error --",r)}}),!this.observedComponents.size&&this.domObserver.disconnect()})}watch(t,n="attach"){const r=t.node;if(!r)return;if(n==="attach"&&document.contains(r[0])){t.emit("component:attached",t),typeof t.onAttach=="function"&&t.onAttach.bind(t)();return}if(n==="detach"&&!document.contains(r[0])){t.emit("component:detached",t),typeof t.onDetach=="function"&&t.onDetach.bind(t)();return}this.unwatch(t);const o=setTimeout(()=>{this.unwatch(t),t.emit(`component:${n}ment-timeout`,t)},this.TIMEOUT);this.observedComponents.set(t,{timeout:o,type:n}),this.observedComponents.size===1&&this.domObserver.observe(document.body,{childList:!0,subtree:!0}),n==="attach"&&t.once("component:attached",()=>this.watch(t,"detach"))}unwatch(t){const n=this.observedComponents.get(t);if(n)clearTimeout(n.timeout),this.observedComponents.delete(t);!this.observedComponents.size&&this.domObserver.disconnect()}dispose(){this.domObserver.disconnect(),this.observedComponents.forEach((t)=>clearTimeout(t.timeout)),this.observedComponents.clear()}}class tn{pending=new Set;isPending=!1;component;metrics={batchCount:0,updatesProcessed:0,lastBatchSize:0,avgBatchSize:"0.00"};constructor(t){this.component=t}queue(t){if(this.pending.add(t),this.component.benchmark.inc("dependencyUpdateCount"),!this.isPending)this.isPending=!0,this.scheduleProcessing()}scheduleProcessing(){Promise.resolve().then(()=>this.processQueue())}processQueue(){const t=Array.from(this.pending);if(this.metrics.batchCount++,this.metrics.lastBatchSize=t.length,this.metrics.updatesProcessed+=t.length,this.metrics.avgBatchSize=(this.metrics.updatesProcessed/this.metrics.batchCount).toFixed(2),this.pending.clear(),this.component.benchmark.trackBatch(t.length),this.applyUpdates(t),this.isPending=!1,this.pending.size>0)this.isPending=!0,this.scheduleProcessing()}applyUpdates(t){t.forEach(({dep:n,dependent:r})=>{try{const o=r.update(r.memo,"batch-updator");if(o)typeof o.memo==="object"&&this.component.FGUD.get(n)?.set(r.path,{...r,memo:o.memo}),typeof o.cleanup==="function"&&o.cleanup()}catch(o){console.error("Failed to update dependency --",o)}})}getMetrics(){return{batchCount:this.metrics.batchCount,lastBatchSize:this.metrics.lastBatchSize,avgBatchSize:this.metrics.avgBatchSize,totalUpdates:this.metrics.updatesProcessed}}}class en{options={emit:!0};__events={};__once_events={};constructor(t){if(t)this.options=t}on(t,n){if(!Array.isArray(this.__events[t]))this.__events[t]=[];return this.__events[t].push(n),this}once(t,n){if(!Array.isArray(this.__once_events[t]))this.__once_events[t]=[];return this.__once_events[t].push(n),this}off(t){return delete this.__events[t],delete this.__once_events[t],this}emit(t,...n){if(!this.options.emit)return;const r=n.map((o)=>typeof o.toJSON==="function"?o.toJSON():o);this.__events[t]?.forEach((o)=>o(...r)),this.__once_events[t]?.forEach((o)=>o(...r)),delete this.__once_events[t]}}var Q=Wt(Qt(),1),we=Wt(Qt(),1),Ge=function(t){for(let n of t)if(typeof n==="object"&&n!==null)return!1;return!0},Be=function(t){for(let[n,r]of t)if(typeof n==="object"&&n!==null||typeof r==="object"&&r!==null)return!1;return!0};we.default.fn.extend({attrs:function(){const t={},n=this[0];return n&&n.nodeType!==Node.TEXT_NODE&&we.default.each(n.attributes,function(){t[this.name]=this.value}),t}});var $t="syn:",kt="fn:",Ft="on-",J=/^\.\.\./,ve=/^\[(.*?)\]$/,kr=["@html","@text"];class nn{debug;initialStats={renderCount:0,elementCount:0,renderTime:0,avgRenderTime:0,maxRenderTime:0,componentCount:0,componentUpdateCount:0,partialCount:0,partialUpdateCount:0,memoryUsage:void 0,domOperations:0,domInsertsCount:0,domUpdatesCount:0,domRemovalsCount:0,dependencyTrackCount:0,dependencyUpdateCount:0,batchSize:0,batchCount:0,errorCount:0};stats=this.reset();renderStartTime=0;renderTimes=[];measurementCount=0;maxMeasurements=100;loggingInterval=10;autoSaveInterval;constructor(t=!1){if(this.debug=t,this.debug)this.autoSaveInterval=window.setInterval(()=>this.storeMetrics(),5000)}storeMetrics(){try{const t=JSON.parse(localStorage.getItem("lipsPerformanceMetrics")||"[]");t.push({timestamp:Date.now(),metrics:{...this.stats}}),t.length>100&&t.shift(),localStorage.setItem("lipsPerformanceMetrics",JSON.stringify(t))}catch(t){}}startRender(){if(!this.debug)return;this.renderStartTime=performance.now()}endRender(){if(!this.debug||this.renderStartTime===0)return;const t=performance.now()-this.renderStartTime;this.stats.renderTime=t,this.stats.maxRenderTime=Math.max(this.stats.maxRenderTime,t),this.renderTimes.push(t),this.renderTimes.length>this.maxMeasurements&&this.renderTimes.shift(),this.stats.avgRenderTime=this.renderTimes.reduce((n,r)=>n+r,0)/this.renderTimes.length,this.renderStartTime=0,this.measurementCount++}inc(t){if(!this.debug)return;if(typeof this.stats[t]==="number")this.stats[t]++}dec(t){if(!this.debug)return;if(typeof this.stats[t]==="number"&&this.stats[t]>0)this.stats[t]--}record(t,n){if(!this.debug)return;if(typeof this.stats[t]!=="undefined")this.stats[t]=n}add(t,n){if(!this.debug)return;if(typeof this.stats[t]==="number")this.stats[t]+=n}reset(){return this.renderTimes=[],this.measurementCount=0,this.stats=nt(this.initialStats)}log(){if(!this.debug)return;if(this.loggingInterval>1&&this.measurementCount%this.loggingInterval!==0)return;const t={"Render Count":this.stats.renderCount,"Element Count":this.stats.elementCount,"Avg Render Time (ms)":this.stats.avgRenderTime.toFixed(2),"Max Render Time (ms)":this.stats.maxRenderTime.toFixed(2)},n={"Component Count":this.stats.componentCount,"Component Updates":this.stats.componentUpdateCount},r={"Partial Count":this.stats.partialCount,"Partial Updates":this.stats.partialUpdateCount},o={"DOM Operations":this.stats.domOperations,"DOM Inserts":this.stats.domInsertsCount,"DOM Updates":this.stats.domUpdatesCount,"DOM Removals":this.stats.domRemovalsCount},p={"Dependencies Tracked":this.stats.dependencyTrackCount,"Dependency Updates":this.stats.dependencyUpdateCount},c={"Batch Count":this.stats.batchCount,"Avg Batch Size":this.stats.batchCount>0?(this.stats.batchSize/this.stats.batchCount).toFixed(2):"0"};console.group("Lips Framework Performance Metrics"),console.table(t),console.table(n),console.table(r),console.table(o),console.table(p),console.table(c),this.stats.memoryUsage&&console.log(`Memory Usage: ${this.stats.memoryUsage.toFixed(2)} MB`),this.stats.errorCount>0&&console.warn(`Errors encountered: ${this.stats.errorCount}`),console.groupEnd(),window.localStorage&&this.measurementCount%10===0&&this.storeMetrics()}trackMemory(){if(!this.debug||!window.performance?.memory)return;this.stats.memoryUsage=window.performance.memory.usedJSHeapSize/1048576}trackBatch(t){if(!this.debug)return;this.stats.batchCount++,this.stats.batchSize+=t}trackError(t){if(!this.debug)return;this.stats.errorCount++,console.error("Lips Framework Error:",t)}setLoggingInterval(t){if(!this.debug)return;this.loggingInterval=t}getSnapshot(){return nt(this.stats)}dispose(){if(!this.debug)return;this.autoSaveInterval&&clearInterval(this.autoSaveInterval)}}var br=Wt(Qt(),1),rn="comm",an="rule",on="decl",Ar="@import",$r="@namespace",xr="@keyframes",Cr="@layer",sn=Math.abs,$e=String.fromCharCode,Jt=1,Vt=1,pn=0,_t=0,tt=0,Lt="";class fn{nsp;settings;$head;constructor(t,n){if(typeof t!=="string")throw new Error("Undefined or invalid styles attachement element(s) namespace");this.nsp=t,this.$head=br.default("head"),this.settings=n||{},this.settings&&this.load(this.settings)}compile(t){try{return Ae(Lr(t),Fr([Mr]))}catch(n){throw new Error(`Style compilation failed: ${n.message}`)}}waitForStyles(t){return new Promise((n)=>{const r=new MutationObserver(()=>{const o=document.querySelector(t);if(o&&getComputedStyle(o).cssText)r.disconnect(),n()});r.observe(document.documentElement,{attributes:!0,childList:!0,subtree:!0})})}async inject(t){if(!t)throw new Error("Invalid injection arguments");const n=`rel="${this.settings.meta?"@":""}${this.nsp}"`;t=this.settings.meta?t:`[rel="${this.nsp}"] { ${t} }`;try{const r=this.compile(t);if(!r)throw new Error(`<component:${this.nsp}> sheet compilation failed`);const o=document.createElement("style");o.setAttribute("rel",`${this.settings.meta?"@":""}${this.nsp}`),o.textContent=r;let p=0;const c=this.$head.find(`style[${n}]`);if(c.length)p=parseInt(c.attr("dindex"))+1,c.remove();return o.setAttribute("dindex",String(p)),this.settings.meta?document.head.prepend(o):document.head.appendChild(o),o}catch(r){throw new Error(`Style injection failed: ${r.message}`)}}async load(t){if(this.settings=t,typeof this.settings!=="object")throw new Error("Undefined styles settings");if(this.settings.sheet){const n=await this.inject(this.settings.sheet);await this.waitForStyles(`style[rel="${this.settings.meta?"@":""}${this.nsp}"]`)}}get(){}async clear(){const t=this.$head.find(`style[rel="${this.settings.meta?"@":""}${this.nsp}"]`);if(!t.length)return;const n=parseInt(t.attr("dindex"));n===0?t.remove():t.attr("dindex",String(n-1))}async custom(){return{}}async style(){return{}}}var Ir=function(t){const n=/on-([a-zA-Z-]+)\s*\(/g;let r=t,o;while((o=n.exec(t))!==null){const p=o[1],c=o.index+o[0].length;let f=1,i=c;while(i<t.length&&f>0){if(t[i]==="(")f++;if(t[i]===")")f--;i++}if(f===0){const _=t.slice(c,i-1).trim(),y=t.slice(0,o.index),h=`${Ft}${p}="${_}"`,b=t.slice(i);r=y+h+b,t=r,n.lastIndex=y.length+h.length}}return r},Ur=function(t){const n=[];let r=t.replace(/<([a-zA-Z][a-zA-Z0-9_-]*)((?:[^>'"]*|'[^']*'|"[^"]*")*?)(?:\/?>)/g,(o,p,c)=>{return n.push(c),`<${p}##TAG_ATTRS_${n.length-1}##>`});for(let o=0;o<n.length;o++){const p=`##TAG_ATTRS_${o}##`,c=n[o],f=Kr(c);r=r.replace(p,f)}return r},Kr=function(t){let n="",r=0,o=!1,p="",c=0,f=0,i=0;while(r<t.length){const _=t[r];if((_==='"'||_==="'")&&(r===0||t[r-1]!=="\\")){if(!o)o=!0,p=_;else if(_===p)o=!1}if(!o){if(_==="(")f++;else if(_===")")f--;else if(_==="{")i++;else if(_==="}")i--}if(!o&&f===0&&i===0&&(_===" "||r===t.length-1)){let y=r;if(r===t.length-1)y=r+1;const h=t.substring(c,y).trim();if(h){const b=wr(h);n+=" "+b}c=r+1}r++}return n},wr=function(t){const n=t.indexOf("=");if(n===-1){if(t.startsWith("...")||t.startsWith("["))return t;return`:${t}="${!t.startsWith("!")}"`}let r=t.substring(0,n).trim(),o=t.substring(n+1).trim();if(r.startsWith("@"))return r=!kr.includes(r)?r.slice(1):r,`:${r}=${o}`;if(r.startsWith(kt)||r.startsWith(Ft))return t;if(o.startsWith('"')&&o.endsWith('"')||o.startsWith("'")&&o.endsWith("'")){const p=o.substring(1,o.length-1);if(Gr(p))return`:${r}="${p}"`;return t}else return`:${r}="${o}"`},Br=function(t,n){if(t.isDisposed)return;n.add(t),t.dependencies.add(n)},ze=function(t){for(let n of t.dependencies)n.delete(t);t.dependencies.clear()},Xt=[],Xe=null;class Ce extends en{declaration;$=null;input;state;static;context;__name__;__path__;__template__;__previous;__stylesheet;__macros=new Map;__renderCache=new Map;FGUD=new Map;PCC=new Map;VER=[];prepath="0";debug=!1;isRendered=!1;__setInput;__setState;__getState;UQS;ICE;lips;benchmark;__path="";__pathCounter=0;__renderDepth=0;constructor(t,n,{input:r,state:o,context:p,_static:c,handler:f,stylesheet:i,macros:_,declaration:y},h){super();if(this.lips=h.lips,h?.debug)this.debug=h.debug;if(h?.prepath)this.prepath=h.prepath;if(this.__name__=t,this.__path__=`${this.prepath}/${this.__name__}`,this.__template__=He(n),this.declaration=y||{name:t},this.input=r||{},this.static=c||{},this.context={},this.state=this.lips.IUC.proxyState(this.__path__,o||{}),_&&this.setMacros(_),f&&this.setHandler(f),i&&this.setStylesheet(i),this.benchmark=new nn(this.debug),this.benchmark.inc("componentCount"),this.UQS=new tn(this),typeof this.onCreate=="function"&&this.onCreate.bind(this)(),this.emit("component:create",this),this.input&&Object.keys(this.input).length&&typeof this.onInput=="function")this.onInput.bind(this)(this.input),this.emit("component:input",this);this.__previous={input:nt(this.input),state:nt(this.state),context:nt(this.context)};const[b,V]=zt(this.input),[R,w]=zt(this.state),[q,et]=zt(this.context);this.__setInput=V,this.__setState=w,this.__getState=R,this.lips.IUC.register(this.__path__,()=>{ot(this.__previous?.state,this.state)&&this.__setState({...this.__getState(),...this.state})}),Array.isArray(p)&&p.length&&this.lips.useContext(p,(X)=>{if(!ot(this.context,X))return;et(X),this.context=X,typeof this.onContext=="function"&&this.onContext.bind(this)(),this.emit("component:context",this)}),this.ICE=ln(()=>{const X=b(),H=R(),K=this.context=q();if(!this.isRendered){this.benchmark.reset();const{$log:I}=this.render("",void 0,void 0,this.FGUD);this.$=I,!y?.syntax&&this.$?.each((U,x)=>typeof x.setAttribute=="function"&&x.setAttribute("rel",this.__name__)),this.isRendered=!0,typeof this.onMount=="function"&&this.onMount.bind(this)(),this.emit("component:mount",this),this.lips.watcher.watch(this)}else this.__updateDepNodes__({state:H,input:X,context:K},this.__previous),typeof this.onUpdate=="function"&&this.onUpdate.bind(this)(),this.emit("component:update",this),this.__previous={input:nt(X),state:nt(H),context:nt(K)},this.input=X;this.benchmark.log(),typeof this.onRender=="function"&&this.onRender.bind(this)(),this.emit("component:render",this)})}setContext(t,n){this.lips.setContext(t,n)}setInput(t){if(!ot(this.input,t))return;this.__setInput(t),typeof this.onInput=="function"&&this.onInput.bind(this)(t)}subInput(t){if(typeof t!=="object")throw new Error("Invalid sub input data argument");return this.setInput(gr(this.input,t)),this}setMacros(t){const n=He(t),r=Q.default(n);if(!r.length)return;const o=this;r.each(function(){const p=Q.default(this),{argv:c,attrs:f}=o.__getAttributes__(p);if(!Object.keys(f))throw new Error("Invalid macro component definition");if(!f.literals.name)throw new Error("Undefined macro `name` attribute.");if(o.__macros.get(f.literals.name))console.warn(`Duplicate macro <${f.literals.name}> will be override`);if(!p.contents()?.length)throw new Error("Invalid macro component definition. Template content expected.");o.__macros.set(f.literals.name,{argv:c,$node:p})})}setHandler(t){Object.entries(t).map(([n,r])=>this[n]=r.bind(this))}setStylesheet(t){const n={sheet:t,meta:this.__name__==="__ROOT__"};this.__stylesheet=new fn(this.__name__,n)}get node(){if(!this.$)throw new Error("node() is expected to be call after component get rendered");return this.$}find(t){return this.$?.find(t)}render(t,n,r={},o,p){const c=o||new Map,f=[];if(n&&!n.length)return console.warn("Undefined node element to render"),{$log:n,dependencies:c};this.benchmark.startRender();const i=this;let _=Q.default();function y(l){const N=h(l);return i.__pathCounter++,i.__path?`${i.__path}/${N}`:`${t?t+"/":"#"}${N}`}function h(l){return(l==="component"?"c":"")+i.__pathCounter}function b(l){return l!==null&&typeof l==="object"&&typeof l.mesh==="function"&&typeof l.update==="function"}function V(l){return l!==null&&typeof l==="object"&&typeof l.default&&typeof l.default==="string"}function R(l){if(!l.attr(":dtag")||l.prop("tagName")!=="LIPS")throw new Error("Invalid dynamic tag name");const N=l.attr(":dtag"),s=i.__evaluate__(N,r);if(b(s)||s===null)return H(l,N,s);else if(V(s))return K(l,{template:s});else return K(l,{name:s})}function w(l){const N=l.attr(":args"),s=y("log");if(!N)return;if(i.__evaluate__(`console.log(${N})`,r),i.__isReactive__(N,r))i.__extractExpressionDeps__(N,r).forEach((m)=>i.__trackDep__(c,m,{$fragment:null,path:s,update:(E)=>i.__evaluate__(`console.log(${N})`,E),memo:r,batch:!0}))}function q(l){const N=y("var"),{attrs:s}=i.__getAttributes__(l);if(!s)return;Object.entries(s.literals).forEach(([m,E])=>{if(r[m]&&r[m].type==="const")throw new Error(`Cannot override <const ${m}=[value]/> variable`);r[m]={value:E,type:"let"}}),Object.entries(s.expressions).forEach(([m,E])=>{if(J.test(m)){const T=(B,j)=>{const $=i.__evaluate__(m.replace(J,""),j||r);if(typeof $!=="object")throw new Error(`Invalid spread operator ${m}`);for(let O in $){if(r[O]&&r[O].type==="const")throw new Error(`Cannot override <const ${O}=[value]/> variable`);if(r[O]={value:$[O],type:"let"},j)j[O]=r[O],i.__updateVarDepNodes__(O,N,j)}if(B)return{memo:j}};i.__extractExpressionDeps__(m,r).forEach((B)=>i.__trackDep__(c,B,{$fragment:null,path:`${N}.${m}`,update:(j)=>T(!0,j),memo:r,batch:!0})),T()}else if(E){if(i.__isReactive__(E,r)){const T=i.__extractExpressionDeps__(E,r),B=(j,$)=>{if(r[m]&&r[m].type==="const")throw new Error(`Cannot override <const ${m}=[value]/> variable`);return j[m]=r[m]={value:i.__evaluate__(E,j),type:"let"},i.__updateVarDepNodes__(m,N,j),{memo:j}};T.forEach((j)=>i.__trackDep__(c,j,{$fragment:null,path:`${N}.${m}`,update:B,memo:r,batch:!0}))}if(r[m]&&r[m].type==="const")throw new Error(`Cannot override <const ${m}=[value]/> variable`);r[m]={value:i.__evaluate__(E,r),type:"let"}}}),i.benchmark.inc("elementCount")}function et(l){const{attrs:N}=i.__getAttributes__(l);if(!N)return;Object.entries(N.literals).forEach(([s,m])=>{if(r[s]&&r[s].type==="const")throw new Error(`<const ${s}=[value]/> variable already defined`);if(!m)return;r[s]={value:m,type:"const"}}),Object.entries(N.expressions).forEach(([s,m])=>{if(J.test(s)){const E=i.__evaluate__(s.replace(J,""),r);if(typeof E!=="object")throw new Error(`Invalid spread operator ${s}`);for(let T in E){if(r[T]&&r[T].type==="const")throw new Error(`<const ${T}=[value]/> by spread operator ${s}. [${T}] variable already defined`);r[T]={value:E[T],type:"const"}}}else{if(r[s]&&r[s].type==="const")throw new Error(`<const ${s}=[value]/> variable already defined`);if(!m)return;r[s]={value:i.__evaluate__(m,r),type:"const"}}}),i.benchmark.inc("elementCount")}function X(l){const N=y("element"),s=l.contents();let m=Q.default();if(s.length)m=m.add(i.__withPath__(N,()=>i.render(N,s,r,c,p).$log));return m}function H(l,N,s){const{attrs:m}=i.__getAttributes__(l),E=y("element"),T=i.__getBoundaries__(E);let B=Q.default(T.start),j={},$=s;if($){m.literals&&Object.entries(m.literals).forEach(([C,D])=>j[C]={type:"arg",value:D}),m.expressions&&Object.entries(m.expressions).forEach(([C,D])=>{if(!$)return;if(J.test(C)){const S=i.__evaluate__(C.replace(J,""),r);if(typeof S!=="object")throw new Error(`Invalid spread operator ${C}`);for(let k in S){if(k!=="#"&&!$.argv.includes(k))continue;j[k]={type:"arg",value:S[k]}}}else{if(C!=="#"&&!$.argv.includes(C))return;j[C]={type:"arg",value:D?i.__evaluate__(D,r):!0}}});const O=$.mesh(j);if(O&&O.length)B=B.add(O);m.expressions&&Object.entries(m.expressions).forEach(([C,D])=>{if(!$)return;if(J.test(C)&&i.__isReactive__(C,r)){const S=i.__extractExpressionDeps__(C,r),k=(g,M)=>{if(!$)return;const z={},F=i.__evaluate__(C.replace(J,""),g);if(typeof F!=="object")throw new Error(`Invalid spread operator ${C}`);const Y=[];for(let W in F){if(W!=="#"&&!$.argv.includes(W))continue;j[W]=z[W]={type:"arg",value:F[W]},(!g[W]||!St(F[W],g[W].value))&&Y.push(W)}Y.length&&$.update(Y,z,T)};S.forEach((g)=>i.__trackDep__(c,g,{$fragment:null,boundaries:T,path:`${E}.${C}`,update:k,memo:r,batch:!0}))}else if((C==="#"||$.argv.includes(C))&&i.__isReactive__(D,r)){const S=i.__extractExpressionDeps__(D,r),k=(g,M)=>{if(!$)return;const z=j[C]={type:"arg",value:D?i.__evaluate__(D,g):!0};$.update([C],{[C]:z},T)};S.forEach((g)=>i.__trackDep__(c,g,{$fragment:null,boundaries:T,path:`${E}.${C}`,update:k,memo:r,batch:!0}))}})}if(i.__isReactive__(N,r)){const O=(C,D)=>{const S=i.__evaluate__(N,C);let k;if(V(S))k=K(l,{template:S});else if(b(S))j="#"in j?{...C,...j["#"].value}:{...C,...j},$=S,k=$?$.mesh(j):null;if(!document.contains(T.start)||!document.contains(T.end))throw new Error("Dynamic element boundaries not found");const g=[];let M=T.start.nextSibling;while(M&&M!==T.end)g.push(M),M=M.nextSibling;Q.default(g).remove(),k&&Q.default(T.start).after(k)};i.__extractExpressionDeps__(N,r).forEach((C)=>i.__trackDep__(c,C,{$fragment:null,boundaries:T,path:E,update:O,batch:!0,memo:{...r,...j}}))}return B=B.add(T.end),B}function K(l,N){let s,m;if(console.log("dynamic --",N),N?.template)s=N.template,m=h("component");else{if(m=N?.name||l.prop("tagName")?.toLowerCase(),!m)throw new Error("Invalid component");if(m===i.__name__)throw new Error("Render component within itself is forbidden");s=i.lips.import(m)}if(!s||!m)throw new Error(`<${m}> template not found`);const E=y("component"),T=i.__getBoundaries__(E),{argv:B,attrs:j,events:$}=i.__getAttributes__(l),O={};let C={},D=Q.default(T.start),S=i.PCC.get(E);j.literals&&Object.entries(j.literals).forEach(([g,M])=>{if(g=="key")return;C[g]=M}),j.functions&&Object.entries(j.functions).forEach(([g,M])=>{C[g]=i.__evaluateFunction__(M,[],r),s.declaration?.syntax?O[$t+kt+g]=M:O[kt+g]=M}),j.expressions&&Object.entries(j.expressions).forEach(([g,M])=>{if(g=="key")return;if(J.test(g)){const z=i.__evaluate__(g.replace(J,""),r);if(typeof z!=="object")throw new Error(`Invalid spread operator ${g}`);for(let F in z)C[F]=z[F]}else C[g]=M?i.__evaluate__(M,r):!0;s.declaration?.syntax?O[$t+g]=M:O[g]=M});const k=l.contents();if(k.length){if(C={...C,...i.__meshwire__({$node:l,fragmentPath:E,fragmentBoundaries:T,meshPath:null,argv:B,scope:r,xmlns:p,useAttributes:!0,declaration:s.declaration},O)},s.declaration){if(s.declaration.tags)Object.entries(s.declaration?.tags).forEach(([g,{type:M,many:z}])=>{switch(M){case"nexted":{let F=l.next(g);if(!F.length)return;if(z){C[g]=[];let Y=0,W=!1;while(!W){if(C[g].push(i.__meshwire__({$node:F,meshPath:`${g}[${Y}]`,fragmentPath:E,fragmentBoundaries:T,argv:B,scope:r,xmlns:p,useAttributes:!0,declaration:s.declaration},O)),!F.next(g).length){W=!0;break}F=F.next(g),Y++}}else C[g]=i.__meshwire__({$node:F,meshPath:g,fragmentPath:E,fragmentBoundaries:T,argv:B,scope:r,xmlns:p,useAttributes:!0,declaration:s.declaration},O)}break;case"child":{const F=l.children(g);if(z)C[g]=[],F.each(function(Y){const W=Q.default(this),{argv:ut}=i.__getAttributes__(W);C[g].push(i.__meshwire__({$node:W,meshPath:`${g}[${Y}]`,fragmentPath:E,fragmentBoundaries:T,argv:ut,scope:r,xmlns:p,useAttributes:!0,declaration:s.declaration},O))});else if(l.children(g).first().length){const Y=l.children(g).first(),{argv:W}=i.__getAttributes__(Y);C[g]=i.__meshwire__({$node:Y,meshPath:g,fragmentPath:E,fragmentBoundaries:T,argv:W,scope:r,xmlns:p,useAttributes:!0,declaration:s.declaration},O)}}break}});else if(s.declaration.contents)C.__contents__=k}}if(S)S.setInput(nt(C)),D=D.add(S.node);else{const{declaration:g,state:M,_static:z,handler:F,context:Y,default:W,stylesheet:ut}=s;S=new Ce(m,W||"",{state:nt(M),input:nt(C),context:Y,_static:nt(z),handler:F,stylesheet:ut,declaration:g},{debug:i.debug,lips:i.lips,prepath:E}),D=D.add(S.node),i.PCC.set(E,S),Object.entries($).forEach(([Z,it])=>!!S&&i.__attachEvent__(S,Z,it,r)),O&&Object.entries(O).forEach(([Z,it])=>{let ct=!1,st=!1;if(Z.startsWith($t))ct=!0,Z=Z.replace($t,"");if(Z.startsWith(kt))st=!0,Z=Z.replace(kt,"");if(J.test(Z)){const Et=(lt)=>{const Rt={},Nt=i.__evaluate__(Z.replace(J,""),lt);if(typeof Nt!=="object")throw new Error(`Invalid spread operator ${Z}`);for(let Mt in Nt)Rt[Mt]=Nt[Mt];S?.subInput(Rt)};if(i.__isReactive__(Z,r))i.__extractExpressionDeps__(it,r).forEach((lt)=>i.__trackDep__(c,lt,{$fragment:null,boundaries:T,path:`${E}.${Z}`,update:Et,syntax:ct,memo:r,batch:!0}))}else{const Et=(lt)=>{const Rt=st?i.__evaluateFunction__(it,[],lt):it?i.__evaluate__(it,lt):!0;S?.subInput({[Z]:Rt})};if(i.__isReactive__(it,r))i.__extractExpressionDeps__(it,r).forEach((lt)=>i.__trackDep__(c,lt,{$fragment:null,boundaries:T,path:`${E}.${Z}`,update:Et,syntax:ct,memo:r,batch:!0}))}}),D=D.add(T.end)}return i.benchmark.inc("componentCount"),D}function I(l){const N=l.prop("tagName")?.toLowerCase();if(!N)throw new Error("Invalid macro rendering call");const s=i.__macros.get(N);if(!s)throw new Error("Macro component not found");const m=y("macro"),E=i.__getBoundaries__(m),{attrs:T}=i.__getAttributes__(l),B={};let j={},$={},O=Q.default(E.start);if(T.literals&&Object.entries(T.literals).forEach(([k,g])=>j[k]={value:g,type:"arg"}),T.expressions&&Object.entries(T.expressions).forEach(([k,g])=>{if(J.test(k)){const M=i.__evaluate__(k.replace(J,""),r);if(typeof M!=="object")throw new Error(`Invalid spread operator ${k}`);for(let z in M)if($[z]=M[z],s.argv.includes(z))j[z]={value:M[z],type:"arg"};B[k]=g}else{const M=g?i.__evaluate__(g,r):!0;if($[k]=M,s.argv.includes(k))j[k]={value:M,type:"arg"};if(s.argv.includes(k))B[k]=g}s.argv.forEach((M)=>{if(j[M]!==void 0)return;j[M]={value:!1,type:"arg"}})}),s.argv.includes("__"))j.__={value:$,type:"arg"};const C={$node:s.$node,meshPath:null,fragmentPath:m,fragmentBoundaries:E,argv:s.argv,scope:r,xmlns:p,useAttributes:!0},D=i.__meshwire__(C,B),S=D.renderer.mesh(j);return O=O.add(S),B&&Object.entries(B).forEach(([k,g])=>{let M=!1;if(new RegExp(`^${$t}`).test(k))M=!0,k=k.replace($t,"");if(J.test(k)){if(!i.__isReactive__(k,r))return;const z=i.__extractExpressionDeps__(k,r),F=(Y)=>{const W={},ut=i.__evaluate__(k.replace(J,""),Y);if(typeof ut!=="object")throw new Error(`Invalid spread operator ${k}`);const Z=[];for(let it in ut)W[it]={value:ut[it],type:"arg"},(!Y[it]||!St(ut[it],Y[it].value))&&Z.push(it);return Z.length&&D.renderer.update(Z,W),{memo:{...Y,...W}}};z.forEach((Y)=>i.__trackDep__(c,Y,{$fragment:null,boundaries:E,path:`${m}.${k}`,update:F,syntax:M,memo:{...r,...j},batch:!0}))}else if(i.__isReactive__(g,r)){const z=i.__extractExpressionDeps__(g,r),F=(Y)=>{const W=Y[k]={value:g?i.__evaluate__(g,Y):!0,type:"arg"};return D.renderer.update([k],{[k]:W}),{memo:Y}};z.forEach((Y)=>i.__trackDep__(c,Y,{$fragment:null,boundaries:E,path:`${m}.${k}`,update:F,syntax:M,memo:{...r,...j},batch:!0}))}}),O=O.add(E.end),i.benchmark.inc("elementCount"),O}function U(l){if(!l.length||!l.prop("tagName"))return l;const N=l.is("svg")||p,s=N?Q.default(document.createElementNS("http://www.w3.org/2000/svg",l.prop("tagName").toLowerCase())):Q.default(`<${l.prop("tagName").toLowerCase()}/>`),m=l.contents(),E=y("element");m.length&&s.append(i.__withPath__(E,()=>i.render(E+".n",m,r,c,N).$log));const{attrs:T,events:B}=i.__getAttributes__(l);T.literals&&Object.entries(T.literals).forEach(([$,O])=>s.attr($,O));const j=($,O=!1)=>{$&&Object.entries($).forEach(([C,D])=>{switch(C){case"@html":{const S=(k)=>{s.html(i.__evaluate__(D,k))};if(S(r),O&&i.__isReactive__(D,r))i.__extractExpressionDeps__(D,r).forEach((k)=>i.__trackDep__(c,k,{$fragment:s,path:`${E}.${C}`,update:S,memo:r,batch:!0}))}break;case"@text":{const S=(k)=>{let g=i.__evaluate__(D,k);if(!l.is("[no-translate]")){const{text:M}=i.lips.i18n.translate(g);g=M}s.text(g)};if(S(r),O&&i.__isReactive__(D,r))i.__extractExpressionDeps__(D,r).forEach((k)=>i.__trackDep__(c,k,{$fragment:s,path:`${E}.${C}`,update:S,memo:r,batch:!0}))}break;case"style":{const S=(k)=>{const g=i.__evaluate__(D,k);if(typeof g==="object"){let M="";Object.entries(g).forEach(([z,F])=>M+=`${z}:${F};`),M.length&&s.attr("style",M)}else s.attr("style",g)};if(S(r),O&&i.__isReactive__(D,r))i.__extractExpressionDeps__(D,r).forEach((k)=>i.__trackDep__(c,k,{$fragment:s,path:`${E}.${C}`,update:S,memo:r,batch:!0}))}break;default:{const S=(k)=>{const g=D?i.__evaluate__(D,k):D!==void 0?D:!0;g===void 0||g===!1?s.removeAttr(C):s.attr(C,g)};if(S(r),O&&i.__isReactive__(D,r))i.__extractExpressionDeps__(D,r).forEach((k)=>i.__trackDep__(c,k,{$fragment:s,path:`${E}.${C}`,update:S,memo:r,batch:!0}))}}})};return T.expressions&&Object.keys(T.expressions).forEach(($)=>{if(!J.test($))return;const O=(C)=>{const D={},S=i.__evaluate__($.replace(J,""),C);if(typeof S!=="object")throw new Error(`Invalid spread operator ${$}`);for(let k in S)D[k]=S[k];j(D)};if(delete T.expressions[$],O(r),$&&i.__isReactive__($,r))i.__extractExpressionDeps__($,r).forEach((C)=>i.__trackDep__(c,C,{$fragment:s,path:`${E}.${$}`,update:O,memo:r,batch:!0}))}),j(T.expressions,!0),B&&Object.entries(B).forEach(([$,O])=>{f.push({_event:$,$fragment:s,instruction:O,scope:r})}),i.benchmark.inc("elementCount"),i.benchmark.inc("domInsertsCount"),s}function x(l){const N=y("element"),s=l.text(),m=Q.default(document.createTextNode(i.__interpolate__(s,r)));if(s&&i.__isReactive__(s,r)){const E=i.__extractTextDeps__(s,r),T=(B)=>{const j=i.__interpolate__(s,B);if(!m[0])return;m[0].textContent=j};E.forEach((B)=>i.__trackDep__(c,B,{path:N,$fragment:m,update:T,memo:r,batch:E.length>1}))}return i.benchmark.inc("elementCount"),i.benchmark.inc("domInsertsCount"),m}function P(l){if(l.get(0)?.nodeType===Node.COMMENT_NODE)return l;if(l.get(0)?.nodeType===Node.TEXT_NODE)return x(l);if(l.is("let"))return q(l);else if(l.is("const"))return et(l);else if(l.is("lips")&&l.is("[fragment]"))return X(l);else if(l.is("lips")&&l.attr(":dtag"))return R(l);else if(l.is("log"))return w(l);else if(i.__macros.has(l.prop("tagName")?.toLowerCase()))return I(l);else if(l.is("if, for, switch, async")||i.lips.has(l.prop("tagName")?.toLowerCase()))return K(l);else if(l.is("else-if, else"))return;return U(l)}try{this.__renderDepth++,n=n||Q.default(this.__template__),n.each(function(){const l=P(Q.default(this));if(l)_=_.add(l)}),f.forEach(({$fragment:l,_event:N,instruction:s,scope:m})=>{this.__attachEvent__(l,N,s,m)}),i.benchmark.inc("renderCount")}catch(l){console.error("Rendering Failed --",l),i.benchmark.trackError(l)}finally{if(this.__renderDepth--,this.benchmark.endRender(),this.benchmark.trackMemory(),this.__renderDepth===0)this.__path="",this.__pathCounter=0}return{$log:_,dependencies:c,events:f}}destroy(){this.ICE.dispose(),this.benchmark.dispose(),this.lips.IUC.unregister(this.__path__),this.lips.watcher.unwatch(this),this.VER.forEach(({element:t,_event:n})=>this.__detachEvent__(t,n)),this.VER=[];for(let t in this.PCC){const n=this.PCC.get(t);n?.destroy(),n?.delete(t)}if(this.$?.remove(),this.PCC?.clear(),this.FGUD?.clear(),this.state.reset(),this.__macros.clear(),this.__stylesheet?.clear(),this.__previous=null,this.state=null,this.input=null,this.context=null,this.$)this.$.each((t,n)=>{Q.default(n).off()}),this.$=null}__meshwire__(t,n){const r=this,{$node:o,meshPath:p,fragmentPath:c,fragmentBoundaries:f,argv:i,scope:_,xmlns:y,declaration:h,useAttributes:b}=t;let V,R=[];const w=[],q=(K,I,U)=>{const x=`${c}.${p||"r"}${U!==void 0?`[${U}]`:""}`,{$log:P,dependencies:l,events:N}=r.render(x,K,{..._,...I},void 0,y);if(w.push(x),l?.forEach((s,m)=>{if(!r.FGUD?.has(m))r.FGUD.set(m,new Map);s.forEach((E,T)=>{E.partial?.length?E.partial.push(x):E.partial=[x],r.FGUD.get(m)?.set(T,E)})}),r.benchmark.inc("partialCount"),U!==void 0){const s=r.__getBoundaries__(x);R[U]={argvalues:I,boundaries:s};let m=Q.default(s.start);return m=m.add(P),m=m.add(s.end),m}return P},et=(K,I,U)=>{if(r.benchmark.startRender(),K.forEach((x)=>{const P=r.FGUD.get(x);if(!P)return;P.forEach((l)=>{const N=w.find((s)=>l.partial?.find((m)=>s==m));if(!l.partial||!N)return;if(U!==void 0&&!N.endsWith(`r[${U}]`))return;if(f?.start&&!document.contains(f.start)){console.warn(`${p} -- partial boundaries missing in the DOM`),P.delete(l.path);return}if(l.memo?.[x]&&I?.[x]&&St(l.memo[x],I[x]))return;if(l.memo={..._,...l.memo,...I},l.batch)r.UQS.queue({dep:x,dependent:l});else{const s=l.update(l.memo,"mesh-partial-updator");if(s)typeof s.memo==="object"&&P.set(l.path,{...l,memo:s.memo}),typeof s.cleanup==="function"&&s.cleanup()}r.benchmark.inc("dependencyUpdateCount")}),!P.size&&r.FGUD.delete(x)}),U!==void 0&&R[U])R[U].argvalues=I;r.benchmark.inc("partialUpdateCount"),r.benchmark.endRender()},X=(K)=>{if(!R[K])return;const I=R[K].boundaries;if(delete R[K],!document.contains(I.start)||!document.contains(I.end)){console.warn(`Partial mesh item<${K}> boundaries missing`);return}const U=[];let x=I.start.nextSibling;while(x&&x!==I.end)U.push(x),x=x.nextSibling;Q.default(U).remove(),I.start.remove(),I.end.remove()},H={renderer:{path:p,argv:i,mesh(K,I=!1){if(V=o.contents(),!V?.length)return null;if(h?.iterator){const U=K?.["#"].value;if(!Array.isArray(K?.["#"].value))throw new Error("Invalid iterator argvalues");if(!U.length)return null;let x=Q.default();return U.forEach((P,l)=>{if(!V?.length)return null;x=x.add(q(V,P,l))}),x}else return q(V,K)},update(K,I,U){if(!w.length)return;if(U=U||f,h?.iterator){const x=I?.["#"].value;if(!Array.isArray(x))return;if(Array.isArray(R)){if(R.length===x.length){for(let l=0;l<x.length;l++)!St(R[l].argvalues,x[l])&&et(Object.keys(x[l]),x[l],l);return}const P=Math.min(R.length,x.length);for(let l=0;l<P;l++)et(Object.keys(x[l]),x[l],l);if(x.length>R.length){if(!V?.length)return;for(let l=R.length;l<x.length;l++){const N=q(V,x[l],l);Q.default(U.end).before(N)}}else if(x.length<R.length)for(let l=x.length;l<R.length;l++)X(l)}}else et(K,I)}}};if(b&&p){const{attrs:K}=r.__getAttributes__(o);K.literals&&Object.entries(K.literals).forEach(([I,U])=>H[I]=U),K.expressions&&Object.entries(K.expressions).forEach(([I,U])=>{if(J.test(I)){const x=r.__evaluate__(I.replace(J,""),_);if(typeof x!=="object")throw new Error(`Invalid spread operator ${I}`);for(let P in x)H[P]=x[P];n[`${h?.syntax?$t:""}${p}.${I}`]=U}else H[I]=U?r.__evaluate__(U,_):!0,n[`${h?.syntax?$t:""}${p}.${I}`]=U})}return H}__getBoundaries__(t){return this.benchmark.inc("domOperations"),this.benchmark.inc("domInsertsCount"),{start:document.createComment(`s:${this.prepath}.${t}`),end:document.createComment(`e:${this.prepath}.${t}`)}}__getAttributes__(t){const n=t.attrs(),r={},o={literals:{},functions:{},expressions:{}};let p=[];return n&&Object.entries(n).forEach(([c,f])=>{if(c==":dtag")return;if(c.startsWith(":")||c.startsWith(kt)||c.startsWith(Ft)||J.test(c)||ve.test(c))if(ve.test(c)){const[i,_]=c.match(ve)||[];p=_.split(",")}else if(c.startsWith(Ft))r[c.replace(Ft,"")]=f;else if(c.startsWith(kt))o.functions[c.replace(kt,"")]=f;else{if(c.startsWith(":"))c=c.slice(1,c.length);o.expressions[c]=f||""}else o.literals[c]=f}),{argv:p,events:r,attrs:o}}__withPath__(t,n){const r=this.__path;this.__path=t;const o=n();return this.__path=r,o}__getPathParent__(t){const n=t.split("/");return n.pop(),n.join("/")}__hasSamePathParent__(t,n){return t.startsWith(n)}__evaluate__(t,n){try{t=t.trim();const r=this.state.toJSON();if(n){const o={};for(let c in n)o[c]=n[c].value;const p=`with( scope ){ return ${t}; }`;return new Function("self","input","state","static","context","scope",p)(this,this.input,r,this.static,this.context,o||{})}else{const o=`return ${t}`;return new Function("self","input","state","static","context",o)(this,this.input,r,this.static,this.context)}}catch(r){return t}}__evaluateFunction__(t,n,r){if(/(\s*\w+|\s*\([^)]*\)|\s*)\s*=>\s*(\s*\{[^}]*\}|\s*[^\n;"]+)/g.test(t))return this.__evaluate__(t,r)(...n);else{let[o,...p]=t.split(/\s*,\s*/),c;if(o=this.__evaluate__(o,r),typeof o==="function")c=o;else{if(typeof this[o]!=="function")throw new Error(`Undefined <${o}> handler method`);c=this[o].bind(this)}if(typeof c!=="function")throw new Error(`Expected <${o}> to be a function or handler method`);let f=p.map((i)=>this.__evaluate__(i,r));if(n.length)f=[...f,...n];return c(...f)}}__interpolate__(t,n){return t.replace(/{\s*([^{}]+)\s*}/g,(r,o)=>this.__evaluate__(o,n))}__attachEvent__(t,n,r,o){t.on(n,(...p)=>this.__evaluateFunction__(r,p,o)),this.VER.push({element:t,_event:n}),this.benchmark.inc("domUpdatesCount"),this.benchmark.inc("domRemovalsCount")}__detachEvent__(t,n){t.off(n),this.benchmark.inc("domOperations"),this.benchmark.inc("domRemovalsCount")}__extractTextDeps__(t,n){const r=new Set;return(t.match(/{\s*([^{}]+)\s*}/g)||[]).forEach((o)=>{const p=o.replace(/[{}]/g,"").trim();this.__extractExpressionDeps__(p,n).forEach((c)=>r.add(c))}),Array.from(r)}__extractExpressionDeps__(t,n){const r=/\b(state|input|context)(?:\.[a-zA-Z_]\w*)+(?=\[|\.|$|\s|;|,|\))/g,o=/\b(self)(?:\.[a-zA-Z_]\w*)+(?=\()/g;let p=[...Array.from(t.matchAll(r)),...Array.from(t.matchAll(o))];if(n&&Object.keys(n).length){const c=new RegExp(`\\b(${Object.keys(n).join("|")})`,"g");p=[...p,...Array.from(t.matchAll(c))]}return[...new Set(p.map((c)=>c[0]))]}__isReactive__(t,n){if(/(state|input|context|self)\.[\w.]+/.test(t))return!0;if(n&&Object.keys(n).length&&new RegExp(Object.keys(n).join("|")).test(t))return!0;return!1}__trackDep__(t,n,r){if(r.memo&&r.memo[n]&&r.memo[n].type==="let")r.haslet=!0;!t.has(n)&&t.set(n,new Map),t.get(n)?.set(r.path,r),this.benchmark.inc("dependencyTrackCount")}__valueDep__(t,n){return n.reduce((r,o)=>r?.[o],t)}__shouldUpdate__(t,n,r,o){if(t==="self")return!0;const p=this.__valueDep__(o[t],n),c=this.__valueDep__(r[t],n);return!St(p,c)}__updateDepNodes__(t,n){if(!this.FGUD?.size)return;this.benchmark.inc("componentUpdateCount"),this.benchmark.startRender(),this.FGUD.forEach((r,o)=>{const[p,...c]=o.split(".");if(!this.__shouldUpdate__(p,c,t,n))return;r.forEach((f)=>{const{path:i,batch:_,$fragment:y,boundaries:h,update:b,memo:V,syntax:R}=f;try{if(!R&&(h?.start&&!document.contains(h.start))||y!==null&&!y.closest("body").length){r.delete(i);return}if(_)this.UQS.queue({dep:o,dependent:f});else{const w=b(V,"main-updator");if(w)typeof w.memo==="object"&&r.set(i,{...f,memo:w.memo}),typeof w.cleanup==="function"&&w.cleanup()}this.benchmark.inc("dependencyUpdateCount")}catch(w){console.error("failed to update dependency nodes --",w);return}}),!r.size&&this.FGUD?.delete(o)}),this.benchmark.endRender()}__updateVarDepNodes__(t,n,r){if(!this.FGUD?.size)return;this.benchmark.inc("partialUpdateCount"),this.benchmark.startRender(),this.FGUD.get(t)?.forEach((o,p)=>{if(!o.haslet||!this.__hasSamePathParent__(p,this.__getPathParent__(n)))return;if(o.memo={...o.memo,...r},o.batch)this.UQS.queue({dep:t,dependent:o});else{const c=o.update(o.memo,"var-partial-updator");typeof c?.cleanup==="function"&&c.cleanup()}}),this.benchmark.endRender()}appendTo(t){const n=typeof t=="string"?Q.default(t):t;return this.$?.length&&n.append(this.$),this.benchmark.inc("domOperations"),this}prependTo(t){const n=typeof t=="string"?Q.default(t):t;return this.$?.length&&n.prepend(this.$),this.benchmark.inc("domOperations"),this}replaceWith(t){const n=typeof t=="string"?Q.default(t):t;return this.$?.length&&n.replaceWith(this.$),this.benchmark.inc("domOperations"),this}}var _n={};Ut(_n,{state:()=>{return Yr},handler:()=>{return Hr},default:()=>{return zr},declaration:()=>{return qr}});var qr={name:"if",syntax:!0,tags:{"else-if":{type:"nexted",many:!0,optional:!0},else:{type:"nexted",optional:!0}}},Yr={renderer:null},Hr={onInput(){if(!this.input.renderer)return;if(this.input.by)this.state.renderer=this.input.renderer;else{let t=!1;if(Array.isArray(this.input["else-if"])&&this.input["else-if"].length)this.input["else-if"].forEach((n)=>{if(t||!n.by)return;this.state.renderer=n.renderer,t=!0});if(!t)this.state.renderer=this.input.else?this.input.else.renderer:null}}},zr="<{state.renderer}/>",dn={};Ut(dn,{state:()=>{return Wr},handler:()=>{return Zr},default:()=>{return Jr},declaration:()=>{return Xr},_static:()=>{return Qr}});var Xr={name:"for",syntax:!0,iterator:!0},Wr={argvlist:null},Qr={lastInput:null,processingBatch:!1},Zr={onInput(){if(this.static.processingBatch)return;if(!this.input.renderer)throw new Error("Undefined mesh renderer");let{in:t,from:n,to:r}=this.input;if(t===void 0&&n===void 0)throw new Error("Invalid <for> arguments");this.static.processingBatch=!0;try{if(n!==void 0){if(n=parseFloat(String(n)),r==null)throw new Error("Expected <from> <to> attributes of the for loop to be defined");if(r=parseFloat(String(r)),n===r)throw new Error("<from> and <to> attribute cannot have the same value");const o=n<r,p=Math.abs(r-n)+1;if(this.state.argvlist&&Array.isArray(this.state.argvlist)&&this.state.argvlist.length===p){const[f]=this.input.renderer.argv;if(f){let i=n,_=!0;for(let y=0;y<this.state.argvlist.length;y++){if(this.state.argvlist[y][f].value!==i){_=!1;break}i=o?i+1:i-1}if(_)return;i=n;for(let y=0;y<this.state.argvlist.length;y++)this.state.argvlist[y][f].value=i,i=o?i+1:i-1;return}}const c=[];for(let f=n;o?f<=r:f>=r;o?f++:f--){const i={},[_]=this.input.renderer.argv;if(_)i[_]={value:f,type:"arg"};c.push(i)}this.state.argvlist=c}else if(Array.isArray(t)){if(this.state.argvlist&&this.static.lastInput&&this.input.in===this.static.lastInput)return;if(!t.length){console.warn("empty for loop <in> attribute Array value"),this.state.argvlist=[];return}if(this.static.lastInput=t,this.state.argvlist&&Array.isArray(this.state.argvlist)&&this.state.argvlist.length===t.length){const[c,f]=this.input.renderer.argv;for(let i=0;i<t.length;i++){const _=this.state.argvlist[i];if(c)_[c].value=t[i]}return}const o=[];let p=0;for(let c of t){const f={},[i,_]=this.input.renderer.argv;if(i)f[i]={value:c,type:"arg"};if(_)f[_]={value:p,type:"arg"};o.push(f),p++}this.state.argvlist=o}else if(t instanceof Map){if(this.state.argvlist&&this.static.lastInput&&this.input.in===this.static.lastInput)return;if(!t.size){console.warn("empty for loop <in> attribute Map value"),this.state.argvlist=[];return}if(this.static.lastInput=t,this.state.argvlist&&Array.isArray(this.state.argvlist)&&this.state.argvlist.length===t.size){const[c,f,i]=this.input.renderer.argv;let _=0;for(let[y,h]of t){const b=this.state.argvlist[_];if(c)b[c].value=y;if(f)b[f].value=h;_++}return}const o=[];let p=0;for(let[c,f]of t){const i={},[_,y,h]=this.input.renderer.argv;if(_)i[_]={value:c,type:"arg"};if(y)i[y]={value:f,type:"arg"};if(h)i[h]={value:p,type:"arg"};o.push(i),p++}this.state.argvlist=o}else if(typeof t=="object"){if(this.state.argvlist&&this.static.lastInput&&this.input.in===this.static.lastInput)return;if(!Object.keys(t).length){console.warn("empty for loop <in> attribute Object value"),this.state.argvlist=[];return}this.static.lastInput=t;const o=Object.keys(t);if(this.state.argvlist&&Array.isArray(this.state.argvlist)&&this.state.argvlist.length===o.length){const[f,i,_]=this.input.renderer.argv;for(let y=0;y<o.length;y++){const h=o[y],b=this.state.argvlist[y];if(f)b[f].value=h;if(i)b[i].value=t[h]}return}const p=[];let c=0;for(let f in t){const i={},[_,y,h]=this.input.renderer.argv;if(_)i[_]={value:f,type:"arg"};if(y)i[y]={value:t[f],type:"arg"};if(h)i[h]={value:c,type:"arg"};p.push(i),c++}this.state.argvlist=p}}finally{this.static.processingBatch=!1}},updateItems(t){if(!this.input.renderer)throw new Error("Undefined mesh renderer");if(!Array.isArray(t)||!this.state.argvlist)return;this.static.processingBatch=!0;try{const[n]=this.input.renderer?.argv;if(!n)return;for(let{index:r,value:o}of t)if(r>=0&&r<this.state.argvlist.length)this.state.argvlist[r][n].value=o}finally{this.static.processingBatch=!1}},updateProperty(t,n){if(!this.input.renderer)throw new Error("Undefined mesh renderer");if(!this.state.argvlist)return;this.static.processingBatch=!0;try{for(let r=0;r<this.state.argvlist.length;r++){const o=this.state.argvlist[r];if(o[t])o[t].value=typeof n==="function"?n(o[t].value,r):n}}finally{this.static.processingBatch=!1}}},Jr="<{input.renderer} #=state.argvlist/>",mn={};Ut(mn,{state:()=>{return ei},handler:()=>{return ni},default:()=>{return ri},declaration:()=>{return ti}});var ti={name:"async",syntax:!0,tags:{then:{type:"child"},catch:{type:"child",optional:!0},loading:{type:"child",optional:!0}}},ei={renderer:null,props:{}},ni={onInput(){if(!this.input.await)throw new Error("Undefined async <await> attribute");if(!(this.input.await instanceof Promise))throw new Error("Expected async <await> attribute value to be a function");if(this.input.loading)this.state.renderer=this.input.loading.renderer,this.state.props={};this.input.await.then((t)=>{if(!this.input.then)return;this.state.renderer=this.input.then.renderer;const[n]=this.input.then.renderer.argv;this.state.props={[n]:{value:t,type:"arg"}}}).catch((t)=>{if(!this.input.catch)return;this.state.renderer=this.input.catch.renderer;const[n]=this.input.then.renderer.argv;this.state.props={[n]:{value:t,type:"arg"}}})}},ri="<{state.renderer} #=state.props/>",yn={};Ut(yn,{state:()=>{return ai},handler:()=>{return oi},default:()=>{return ui},declaration:()=>{return ii}});var ii={name:"switch",syntax:!0,tags:{case:{type:"child",many:!0},default:{type:"child"}}},ai={renderer:null},oi={onInput(){let t=[];for(let n of this.input.case)if(n.is==this.input.by||Array.isArray(n.is)&&n.is.includes(this.input.by))Array.isArray(n.is)?t=[...new Set([...t,...n.is])]:t.push(n.is),this.state.renderer=n.renderer;if(!t.includes(this.input.by))this.state.renderer=this.input.default?this.input.default.renderer:null}},ui="<{state.renderer}/>",hn={};Ut(hn,{state:()=>{return si},handler:()=>{return fi},default:()=>{return li},_static:()=>{return pi}});var ci=function(t){const n={};return t.split("&").map((r)=>{const[o,p]=r.split("=");n[o]=p}),n},si={page:null,params:{},query:{}},pi={global:!1,routes:[],defaultPath:null,currentPath:null,currentRoute:null},fi={onInput(){if(!this.input.routes)return;if(this.input.global)this.static.global=this.input.global;if(this.static.routes=this.input.routes.map(({path:t,template:n,default:r})=>{if(r)this.static.defaultPath=t;const o=t.match(/:[^\/]*(\/|$)/gi)||[],p=t.replaceAll("/","\\/").replaceAll(/:[^\/]*(\/|$)/gi,"([^\\/]+)(?:\\/|$)");return{path:t,template:n,default:r,pathVars:o,pathRegex:new RegExp(`${p}$`,"i")}}),this.input.global){const t=window.location.pathname;this.static.defaultPath=this.static.defaultPath&&t=="/"&&t!==this.static.defaultPath?this.static.defaultPath:t?t+window.location.search:this.static.routes[0].path}},onAttach(){if(this.input.global)window.navigate=this.navigate.bind(this),window.addEventListener("popstate",(t)=>t.state&&this.navigate(t.state.path,!0));this.static.defaultPath&&this.navigate(this.static.defaultPath)},navigate(t,n){!n&&this.static.global&&history.pushState({path:t},"",t);const r=t.split("?");t=r[0];const o=r[1]?ci(r[1]):{};let p=null;if(this.static.currentRoute)p={path:this.static.currentRoute.path,params:this.state.params},this.emit("before",{fromState:p,toState:{path:t,query:o}});const c=this.match(t);if(!c){this.static.currentRoute=null,this.state.params={},this.state.query={},this.emit("not-found",t);return}const{route:f,params:i}=c;this.emit("after",{fromState:p,toState:{path:f.path,params:i,query:o}}),this.static.currentPath=t,this.static.currentRoute=f,this.state.params=i,this.state.query=o,this.state.page=f.template,console.log(this.state.page.toJSON())},match(t){const n={};let r=!1;for(let o of this.static.routes){const{pathVars:p,pathRegex:c}=o,f=t.match(c);if(f!==null&&f.index===0){for(let i=0;i+1<f.length&&i<p.length;i++)n[p[i].replaceAll(/[\/:]/g,"")]=f[i+1];r=o;break}}return r?{route:r,params:n}:!1}},li="<{state.page} params=state.params query=state.query/>";class Te{debug=!1;store={};__root;i18n=new We;watcher;IUC;__setContext;__getContext;constructor(t){if(t?.debug)this.debug=t.debug;this.watcher=new Je,this.IUC=new Ze;const[n,r]=zt(t?.context||{});this.__setContext=r,this.__getContext=n,this.register("if",_n),this.register("for",dn),this.register("async",mn),this.register("switch",yn),this.register("router",hn)}register(t,n){return this.store[t]=n,this}unregister(t){return delete this.store[t],this}has(t){return t in this.store}import(t){if(!this.has(t))throw new Error(`<${t}> component not found`);if(!this.store[t].declaration?.syntax&&!this.store[t].default)throw new Error(`Invalid <${t}> component`);return this.store[t]}render(t,n,r){const{default:o,...p}=n,c={debug:this.debug,prepath:"0",lips:this},f=new Ce(t,o||"",{...p,input:r},c);return window.addEventListener("beforeunload",()=>{return this.dispose(),f.destroy(),null}),window.addEventListener("pagehide",(i)=>{!i.persisted&&this.dispose()}),document.addEventListener("visibilitychange",()=>{if(document.visibilityState!=="hidden")return;this.IUC.prepareForPotentialUnload()}),f}root(t,n){return this.__root=this.render("__ROOT__",t),this.__root.appendTo(n),this.__root}language(t){this.i18n.setLang(t)&&this.__root?.rerender()}setContext(t,n){const r=this.__getContext();if(typeof t==="string"){const o={...r,[t]:n};ot(r,o)&&this.__setContext(o)}else if(!Array.isArray(t)){const o={...r,...t};ot(r,o)&&this.__setContext(o)}else throw new Error("Invalid context data")}getContext(){return this.__getContext()}useContext(t,n){if(!t.length)return;ln(()=>{const r=this.__getContext();if(!r)return;const o=Object.fromEntries(t.map((p)=>[p,r[p]]));o&&typeof n==="function"&&Object.keys(o).length&&n(o)})}dispose(){this.watcher?.dispose(),this.__root?.destroy()}}var vn={Undo:"Undo",Redo:"Redo",Reinitialize:"Reinitialize",Settings:"Settings",Link:"Link","Device Screens":{"*":"Device Screens",UK:"Media Devices"},Bold:"Bold",Count:"Count"};var gn={Undo:"Annuler",Redo:"Refaire",Reinitialize:"R\xE9initialiser",Settings:"Param\xEAtre",Link:"Lien","Device Screens":"Dispositifs",Bold:"Gras",Button:"Bouton",Count:"Compter"};var Ot=new Te;Ot.setContext({lang:"en-US",online:!0,getUser(t){return new Promise((n,r)=>{setTimeout(()=>n({name:t,email:"g.peter@mail.com"}),3000)})}});Ot.i18n.setDictionary("en",vn);Ot.i18n.setDictionary("fr",gn);Ke(Ot);Ot.root(de,"body");setTimeout(()=>{Ot.setContext("online",!1)},5000);setTimeout(()=>window.navigate("/account?userid=1001"),2000);setTimeout(()=>window.navigate("/account?userid=20"),5000);setTimeout(()=>window.navigate("/product/00009?category=phone"),8000);

//# debugId=AC9F7DFC528F9B2B64756e2164756e21
